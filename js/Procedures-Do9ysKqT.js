import{u as v,a as j,j as e,I as w,k as z,l as P,m as S,B as N,n as k,P as F,s as x,b as M}from"./index-ukDIIbbg.js";import{r as i}from"./react-vendor-BQWX9zlF.js";import{i as E,u as R,b as I,R as L,f as V}from"./Reveal-BCIHdFxc.js";import{P as A}from"./ProcedureCard-h1m2DBBp.js";import{S as _}from"./Select-CX30k06x.js";import{S as O}from"./SEO-CXx0XOy8.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-CGxEfUHl.js";import"./form-vendor-BjD3cHyu.js";const B="_filters_1hzoz_1",D="_search_1hzoz_8",$="_selects_1hzoz_12",m={filters:B,search:D,selects:$},q=()=>{const c=v(),{categories:o,filters:a}=j(r=>r.procedures),u=o.map(r=>({value:r,label:r})),d=[{value:"popular",label:"По популярности"},{value:"price-asc",label:"По цене: сначала дешевые"},{value:"price-desc",label:"По цене: сначала дорогие"},{value:"name",label:"По названию"}];return e.jsxs("div",{className:m.filters,children:[e.jsx("div",{className:m.search,children:e.jsx(w,{type:"text",placeholder:"Поиск процедур...",value:a.search,onChange:r=>c(z(r.target.value))})}),e.jsxs("div",{className:m.selects,children:[e.jsx(_,{label:"Категория",options:[{value:"",label:"Все категории"},...u],value:a.category,onChange:r=>c(P(r.target.value))}),e.jsx(_,{label:"Сортировка",options:d,value:a.sort,onChange:r=>c(S(r.target.value))})]}),(a.category||a.search)&&e.jsx(N,{variant:"outline",size:"small",onClick:()=>c(k()),children:"Сбросить фильтры"})]})},G="_procedures_17lzh_1",H="_container_17lzh_6",J="_title_17lzh_11",K="_subtitle_17lzh_19",Q="_grid_17lzh_26",T="_empty_17lzh_32",n={procedures:G,container:H,title:J,subtitle:K,grid:Q,empty:T},ae=()=>{const c=v(),{items:o,filters:a,lastFetched:u,loading:d}=j(t=>t.procedures);i.useEffect(()=>{const t=async()=>{c(x(!0));try{const l=await V();c(M(l))}finally{c(x(!1))}};(o.length===0||E(u,3e5))&&t()},[c,o.length,u]);const r=i.useMemo(()=>{let t=[...o];if(a.category&&(t=t.filter(s=>s.category===a.category)),a.search){const s=a.search.toLowerCase();t=t.filter(l=>l.name.toLowerCase().includes(s)||l.description.toLowerCase().includes(s))}switch(a.sort){case"price-asc":t.sort((s,l)=>s.price-l.price);break;case"price-desc":t.sort((s,l)=>l.price-s.price);break;case"name":t.sort((s,l)=>s.name.localeCompare(l.name));break;case"popular":default:t.sort((s,l)=>s.popular&&!l.popular?-1:!s.popular&&l.popular?1:0);break}return t},[o,a]),y=R(d&&o.length===0,160),[p,f]=i.useState(9),{ref:b,inView:h}=I({once:!1,rootMargin:"600px 0px"}),g=i.useRef(!1);i.useEffect(()=>{f(9)},[a.category,a.search,a.sort]),i.useEffect(()=>{const t=g.current;g.current=h,!(!h||t)&&f(s=>Math.min(s+6,r.length))},[h,r.length]);const C=i.useMemo(()=>r.slice(0,p),[r,p]);return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Процедуры",description:"Каталог косметологических процедур. Чистка лица, массаж, обертывания, аппаратная косметология и многое другое.",keywords:"косметологические процедуры, чистка лица, массаж лица, обертывания, косметология услуги"}),e.jsx("div",{className:n.procedures,children:e.jsxs("div",{className:n.container,children:[e.jsx("h1",{className:n.title,children:"Наши процедуры"}),e.jsx("p",{className:n.subtitle,children:"Выберите процедуру, которая подходит именно вам"}),e.jsx(q,{}),y?e.jsx("div",{className:n.grid,children:Array.from({length:6}).map((t,s)=>e.jsx(F,{},s))}):r.length>0?e.jsxs("div",{className:n.grid,children:[C.map((t,s)=>e.jsx(L,{delayMs:Math.min(s*28,180),children:e.jsx(A,{procedure:t})},t.id)),p<r.length&&e.jsx("div",{ref:b,style:{height:1,width:"100%",gridColumn:"1 / -1"},"aria-hidden":"true"})]}):e.jsx("div",{className:n.empty,children:e.jsx("p",{children:"Процедуры не найдены. Попробуйте изменить фильтры."})})]})})]})};export{ae as default};
