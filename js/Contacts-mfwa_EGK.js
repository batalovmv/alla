import{u as me,a as te,C as he,s as se,b as ge,r as pe,g as fe,e as xe,f as je,q as F,t as k,v as Me,w as _e,j as e,h as ne,B as A,I as T,S as be}from"./index-DeMm2DdY.js";import{f as ye,r as d}from"./react-vendor-BQWX9zlF.js";import{u as ke,a as L,C as we}from"./form-vendor-BjD3cHyu.js";import{f as ve,i as Ne,c as De,b as Se}from"./useInView-D-iRmu2g.js";import{n as Te,f as E,v as Ie,a as Ce}from"./validation-DcG8pJds.js";import{T as qe}from"./Textarea-CN4Hw65e.js";import{S as Ee}from"./Select-BHw39Jx2.js";import{S as He}from"./SEO-24_ux7Rc.js";import{R as re}from"./Reveal-B7THeQyY.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-CGxEfUHl.js";const N=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];function Pe(s){const o=s.getDay();return o===0?"Вс":N[o-1]}function oe(s){const o=s.trim().match(/^(\d{1,2}):(\d{2})$/);if(!o)return null;const r=Number(o[1]),c=Number(o[2]);return!Number.isFinite(r)||!Number.isFinite(c)||r<0||r>23||c<0||c>59?null:r*60+c}function $e(s){const o=s.trim(),r=o.match(/^(Пн|Вт|Ср|Чт|Пт|Сб|Вс)\s*-\s*(Пн|Вт|Ср|Чт|Пт|Сб|Вс)$/);if(r){const g=r[1],l=r[2],m=N.indexOf(g),x=N.indexOf(l);return m===-1||x===-1?[]:m<=x?N.slice(m,x+1):[...N.slice(m),...N.slice(0,x+1)]}const c=o.match(/^(Пн|Вт|Ср|Чт|Пт|Сб|Вс)$/);return c?[c[1]]:[]}function X(s,o){const r=Pe(o),c=String(s||"").split(",").map(g=>g.trim()).filter(Boolean);for(const g of c){const l=g.match(/^(.*?)\s*:\s*(\d{1,2}:\d{2})\s*-\s*(\d{1,2}:\d{2})\s*$/);if(!l)continue;const m=l[1];if(!$e(m).includes(r))continue;const n=oe(l[2]),h=oe(l[3]);if(!(n==null||h==null)&&!(h<=n))return{openMin:n,closeMin:h}}return null}function R(s,o){return Math.ceil(s/o)*o}function W(s){const o=Math.floor(s/60),r=s%60;return`${String(o).padStart(2,"0")}:${String(r).padStart(2,"0")}`}function D(s){const o=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),c=String(s.getDate()).padStart(2,"0");return`${o}-${r}-${c}`}function ae(s){const o=s.now??new Date,r=s.leadMinutes??90,c=s.stepMinutes??15,g=new Date(o.getFullYear(),o.getMonth(),o.getDate()),l=X(s.workingHours,g),m=o.getHours()*60+o.getMinutes(),x=m+r;if(l){const n=l.closeMin-m<=60&&m<l.closeMin;if(m<l.openMin){const h=R(l.openMin+30,c);return{suggestedDate:D(g),suggestedTime:W(Math.min(h,l.closeMin-c)),notice:"Мы ещё не открылись — выбрано ближайшее доступное время.",isClosedNow:!0}}if(m>=l.openMin&&m<l.closeMin){const h=R(x,c);if(!(h>=l.closeMin))return{suggestedDate:D(g),suggestedTime:W(h),notice:n?"До закрытия остался примерно час — пожалуйста, выберите удобное время.":void 0,isClosingSoon:n}}}for(let n=1;n<=14;n++){const h=new Date(g);h.setDate(h.getDate()+n);const p=X(s.workingHours,h);if(!p)continue;const H=R(p.openMin+30,c);return{suggestedDate:D(h),suggestedTime:W(Math.min(H,p.closeMin-c)),notice:"Сейчас мы закрыты — выбрано ближайшее доступное время.",isClosedNow:!0}}return{suggestedDate:D(g),suggestedTime:"10:00",notice:"Не удалось распознать часы работы — выберите дату и время вручную.",isClosedNow:!0}}const Be="_contacts_1nygq_1",Fe="_container_1nygq_6",Ae="_title_1nygq_11",Le="_content_1nygq_19",Re="_infoCard_1nygq_25",We="_formCard_1nygq_26",Xe="_contactItem_1nygq_37",Ve="_social_1nygq_63",Oe="_socialLinks_1nygq_75",ze="_map_1nygq_91",Ue="_mapPlaceholder_1nygq_97",Ke="_mapNote_1nygq_109",Ye="_form_1nygq_26",Ge="_checkbox_1nygq_120",Je="_successMessage_1nygq_138",Qe="_errorMessage_1nygq_147",Ze="_submitButton_1nygq_153",a={contacts:Be,container:Fe,title:Ae,content:Le,infoCard:Re,formCard:We,contactItem:Xe,social:Ve,socialLinks:Oe,map:ze,mapPlaceholder:Ue,mapNote:Ke,form:Ye,checkbox:Ge,successMessage:Je,errorMessage:Qe,submitButton:Ze},ut=()=>{const s=me(),[o]=ye(),{items:r,lastFetched:c,loading:g}=te(t=>t.procedures),{isSubmitting:l,success:m,error:x}=te(t=>t.booking),[n,h]=d.useState({...he,mapEmbedUrl:"",whatsappPhone:""}),{register:p,handleSubmit:H,formState:{errors:M},reset:V,setValue:_,control:I}=ke({defaultValues:{consent:!1}}),P=L({control:I,name:"procedureId"}),S=L({control:I,name:"desiredDate"}),C=L({control:I,name:"desiredTime"}),O=d.useRef(null),z=d.useMemo(()=>`hp_${Math.random().toString(36).slice(2)}`,[]),U=d.useCallback(async()=>{s(se(!0));try{const t=await ve();s(ge(t))}finally{s(se(!1))}},[s]);d.useEffect(()=>{(r.length===0||Ne(c,3e5))&&U()},[r.length,c,U]),d.useEffect(()=>{const t=o.get("procedureId");if(t&&r.length>0&&r.some(u=>u.id===t)){const u=setTimeout(()=>{_("procedureId",t,{shouldValidate:!0,shouldDirty:!0})},0);return()=>clearTimeout(u)}},[o,r,_]),d.useEffect(()=>{if(m){V();const t=setTimeout(()=>{s(pe())},5e3);return()=>clearTimeout(t)}},[m,V,s]),d.useEffect(()=>{const t=!!S,i=!!C;if(t&&i)return;const{suggestedDate:u,suggestedTime:j}=ae({workingHours:n.workingHours,leadMinutes:90,stepMinutes:15});t||_("desiredDate",u,{shouldDirty:!1}),i||_("desiredTime",j,{shouldDirty:!1})},[n.workingHours]);const K=d.useMemo(()=>ae({workingHours:n.workingHours,leadMinutes:90,stepMinutes:15}).notice||"",[n.workingHours]),$=d.useMemo(()=>{if(!S||!C)return"";const t=new Date(`${S}T00:00:00`),i=X(n.workingHours,t);if(!i)return"Для выбранной даты часы работы не указаны. Пожалуйста, выберите другое время.";const[u,j]=C.split(":").map(Number);if(!Number.isFinite(u)||!Number.isFinite(j))return"Укажите корректное время.";const b=u*60+j;if(b<i.openMin||b>=i.closeMin)return"Мы не работаем в это время — выберите другое.";const f=new Date;if(D(f)===S){const v=f.getHours()*60+f.getMinutes();if(b<v+30)return"Пожалуйста, выберите время чуть позже (минимум через 30 минут)."}return""},[n.workingHours,S,C]);d.useEffect(()=>{let t=!0;return fe().then(i=>{t&&h(i)}).catch(()=>{}),()=>{t=!1}},[]);const ie=d.useMemo(()=>r.map(t=>({value:t.id,label:`${t.name} - ${t.price} ₽`})),[r]),B=d.useMemo(()=>P&&r.find(i=>i.id===P)?.name||"",[r,P]),q=d.useMemo(()=>{if(n.whatsappEnabled===!1)return null;const t="Здравствуйте! Хочу записаться в A.K.beauty.",i=B?`${t} Процедура: "${B}".`:t;return xe({whatsappPhone:n.whatsappPhone,text:i})},[n.whatsappEnabled,n.whatsappPhone,B]),w=d.useMemo(()=>je({telegramLink:n.socialMedia.telegram}),[n.socialMedia.telegram]),Y=d.useMemo(()=>F(n.socialMedia.instagram),[n.socialMedia.instagram]),G=d.useMemo(()=>F(n.socialMedia.vk),[n.socialMedia.vk]),J=d.useMemo(()=>F(n.socialMedia.whatsapp),[n.socialMedia.whatsapp]),ce=d.useCallback(async t=>{const i=O.current?.value;if(i&&i.trim().length>0){s(k("Похоже, сработала защита от спама. Обновите страницу и попробуйте снова."));return}const u=Date.now(),j=localStorage.getItem("booking_last_submit_ts"),b=j?Number(j):0;if(b&&u-b<6e4){s(k("Пожалуйста, подождите минуту и попробуйте снова."));return}s(Me());try{const f=Te(t.phone);if(!f){s(k("Укажите телефон в формате +7 (XXX) XXX-XX-XX"));return}const y=String(t.procedureId??"").trim();if(!y){s(k("Выберите процедуру."));return}const v=r.find(ue=>ue.id===y);if(!v){s(k("Выбранная процедура не найдена. Обновите страницу и попробуйте снова."));return}const Z=(t.email??"").trim(),de={...t,procedureId:y,phone:f,email:Z||void 0},ee=await De({...de,procedureName:v.name});ee.success?(localStorage.setItem("booking_last_submit_ts",String(u)),s(_e())):s(k(ee.message||"Ошибка отправки"))}catch(f){s(k(f instanceof Error?f.message:"Произошла ошибка"))}},[s,r]),Q=n.mapEmbedUrl||"",le=Se(g&&r.length===0,160);return e.jsxs(e.Fragment,{children:[e.jsx(He,{title:"Контакты и запись",description:"Свяжитесь с нами или запишитесь на консультацию. Телефон, адрес, форма записи на сеанс.",keywords:"контакты косметолог, запись на процедуру, косметология контакты"}),e.jsx("div",{className:a.contacts,children:e.jsxs("div",{className:a.container,children:[e.jsx("h1",{className:a.title,children:"Контакты и запись"}),e.jsxs("div",{className:a.content,children:[e.jsx("div",{className:a.infoSection,children:e.jsx(re,{children:e.jsxs(ne,{className:a.infoCard,children:[e.jsx("h2",{children:"Контактная информация"}),e.jsxs("div",{className:a.contactItem,children:[e.jsx("strong",{children:"Телефон:"}),e.jsx("a",{href:`tel:${n.phone}`,children:n.phone})]}),q&&e.jsxs("div",{className:a.contactItem,children:[e.jsx("strong",{children:"WhatsApp:"}),e.jsx("a",{href:q,target:"_blank",rel:"noopener noreferrer",children:"Написать в WhatsApp"})]}),w&&e.jsxs("div",{className:a.contactItem,children:[e.jsx("strong",{children:"Telegram:"}),e.jsx("a",{href:w,target:"_blank",rel:"noopener noreferrer",children:"Написать в Telegram"})]}),e.jsxs("div",{className:a.contactItem,children:[e.jsx("strong",{children:"Email:"}),e.jsx("a",{href:`mailto:${n.email}`,children:n.email})]}),e.jsxs("div",{className:a.contactItem,children:[e.jsx("strong",{children:"Адрес:"}),e.jsx("p",{children:n.address})]}),e.jsxs("div",{className:a.contactItem,children:[e.jsx("strong",{children:"Часы работы:"}),e.jsx("p",{children:n.workingHours})]}),e.jsxs("div",{className:a.social,children:[e.jsx("h3",{children:"Социальные сети"}),e.jsxs("div",{className:a.socialLinks,children:[Y&&e.jsx("a",{href:Y,target:"_blank",rel:"noopener noreferrer",children:"Instagram"}),G&&e.jsx("a",{href:G,target:"_blank",rel:"noopener noreferrer",children:"VK"}),w&&e.jsx("a",{href:w,target:"_blank",rel:"noopener noreferrer",children:"Telegram"}),J&&e.jsx("a",{href:J,target:"_blank",rel:"noopener noreferrer",children:"WhatsApp"})]})]}),e.jsx("div",{className:a.map,children:Q?e.jsx("iframe",{title:"Карта",src:Q,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",style:{width:"100%",height:320,border:0,borderRadius:12}}):e.jsxs("div",{className:a.mapPlaceholder,children:[e.jsx("p",{children:"Карта местоположения"}),e.jsx("p",{className:a.mapNote,children:"Укажите VITE_MAP_EMBED_URL в .env.local (или заполните ссылку в админке → Контакты), чтобы встроить карту"})]})})]})})}),e.jsx("div",{className:a.formSection,children:e.jsx(re,{delayMs:60,children:e.jsxs(ne,{className:a.formCard,children:[e.jsx("h2",{children:"Записаться на сеанс"}),m&&e.jsxs("div",{className:a.successMessage,children:["✓ Ваша заявка успешно отправлена! Мы свяжемся с вами в ближайшее время.",q&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:q,target:"_blank",rel:"noopener noreferrer",children:e.jsx(A,{variant:"outline",size:"small",children:"Написать в WhatsApp сейчас"})})}),w&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:w,target:"_blank",rel:"noopener noreferrer",children:e.jsx(A,{variant:"outline",size:"small",children:"Написать в Telegram сейчас"})})})]}),x&&e.jsxs("div",{className:a.errorMessage,children:["✗ ",x]}),e.jsxs("form",{onSubmit:H(ce),className:a.form,children:[e.jsx("input",{ref:O,id:z,name:z,type:"text",tabIndex:-1,autoComplete:"off",style:{position:"absolute",left:"-10000px",top:"auto"},"aria-hidden":"true"}),e.jsx(T,{label:"Имя",...p("name",{required:"Имя обязательно для заполнения",minLength:{value:2,message:"Имя должно содержать минимум 2 символа"}}),error:M.name?.message}),e.jsx(T,{label:"Телефон",type:"tel",inputMode:"tel",autoComplete:"tel",placeholder:"+7 (999) 462-10-36",...p("phone",{required:"Телефон обязателен для заполнения",validate:t=>Ie(t)||"Неверный формат телефона"}),onFocus:t=>{t.target.value||_("phone",E(""),{shouldDirty:!1})},onChange:t=>{const i=E(t.target.value);_("phone",i,{shouldValidate:!0,shouldDirty:!0})},onKeyDown:t=>{if(t.key!=="Backspace")return;const i=t.currentTarget,u=i.value||"",j=i.selectionStart??u.length,b=i.selectionEnd??u.length;if(j!==b||j!==u.length)return;const f=u[u.length-1]||"";if(![")","-"," "].includes(f))return;const y=u.replace(/\D/g,"");if(y.length<=1){t.preventDefault(),_("phone",E(""),{shouldValidate:!0,shouldDirty:!0});return}const v=y.slice(0,-1);t.preventDefault(),_("phone",E(v),{shouldValidate:!0,shouldDirty:!0})},error:M.phone?.message}),e.jsx(T,{label:"Email (необязательно)",type:"email",inputMode:"email",autoComplete:"email",placeholder:"name@example.com",...p("email",{validate:t=>!t||Ce(t)||"Неверный формат email"}),error:M.email?.message}),e.jsx(we,{name:"procedureId",control:I,rules:{required:"Выберите процедуру"},render:({field:t})=>le?e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("label",{style:{fontWeight:600,fontSize:14},children:"Процедура"}),e.jsx(be,{height:56,radius:12})]}):e.jsx(Ee,{label:"Процедура",options:ie,...t,error:M.procedureId?.message})}),e.jsx(T,{label:"Желаемая дата",type:"date",...p("desiredDate",{required:"Укажите желаемую дату",validate:t=>{if(!t)return"Укажите желаемую дату";const i=D(new Date);return t<i?"Нельзя выбрать прошедшую дату":!0}}),error:M.desiredDate?.message}),e.jsx(T,{label:"Желаемое время",type:"time",step:900,...p("desiredTime",{required:"Укажите желаемое время",validate:()=>$||!0}),error:M.desiredTime?.message||$||K||void 0}),e.jsx(qe,{label:"Комментарий",...p("comment",{maxLength:{value:2e3,message:"Комментарий не должен превышать 2000 символов"}}),error:M.comment?.message}),e.jsxs("div",{className:a.checkbox,children:[e.jsx("input",{type:"checkbox",id:"consent",...p("consent",{required:"Необходимо согласие на обработку персональных данных"})}),e.jsxs("label",{htmlFor:"consent",children:["Я согласен(а) на обработку персональных данных."," ",e.jsx("a",{href:"/alla/privacy",target:"_blank",rel:"noopener noreferrer",children:"Политика конфиденциальности"})]}),M.consent&&e.jsx("span",{className:a.errorMessage,children:M.consent.message})]}),e.jsx(A,{type:"submit",size:"large",disabled:l,className:a.submitButton,children:l?"Отправка...":"Отправить заявку"})]})]})})})]})]})})]})};export{ut as default};
