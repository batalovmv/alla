import{W as y,X as _,C as a,Y as M,j as s,p as U,Z as T,h as B,I as l,B as h}from"./index-hyN2hRuu.js";import{r as u}from"./react-vendor-BQWX9zlF.js";import{u as q}from"./form-vendor-BjD3cHyu.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-mpaoXh-M.js";const F="_contacts_amv71_1",z="_title_amv71_5",A="_card_amv71_15",V="_successMessage_amv71_19",O="_form_amv71_28",K="_sectionTitle_amv71_34",L="_actions_amv71_40",i={contacts:F,title:z,card:A,successMessage:V,form:O,sectionTitle:K,actions:L},J=()=>{const[E,w]=u.useState(!0),[f,k]=u.useState(!1),[C,g]=u.useState(!1),{register:t,handleSubmit:$,formState:{errors:o},reset:x,watch:m,getValues:S,setValue:p}=q();u.useEffect(()=>{D()},[]);const D=async()=>{try{w(!0);const e=await y.get();if(e){const r=e.workingSchedule||_(e.workingHours||a.workingHours)||M();x({phone:e.phone||a.phone,whatsappPhone:e.whatsappPhone||"",email:e.email||a.email,address:e.address||a.address,workingSchedule:r,mapEmbedUrl:e.mapEmbedUrl||"",instagram:e.socialMedia?.instagram||a.socialMedia.instagram,vk:e.socialMedia?.vk||a.socialMedia.vk,telegram:e.socialMedia?.telegram||a.socialMedia.telegram,whatsapp:e.socialMedia?.whatsapp||a.socialMedia.whatsapp})}else x({phone:a.phone,whatsappPhone:"",email:a.email,address:a.address,workingSchedule:_(a.workingHours),mapEmbedUrl:"",instagram:a.socialMedia.instagram,vk:a.socialMedia.vk,telegram:a.socialMedia.telegram,whatsapp:a.socialMedia.whatsapp})}catch(e){console.error("Ошибка загрузки контактов:",e)}finally{w(!1)}},N=async e=>{k(!0),g(!1);try{const r=T(e.workingSchedule);await y.update({phone:e.phone,whatsappPhone:String(e.whatsappPhone||"").replace(/\D/g,""),email:e.email,address:e.address,workingHours:r,workingSchedule:e.workingSchedule,mapEmbedUrl:e.mapEmbedUrl||"",socialMedia:{instagram:e.instagram,vk:e.vk,telegram:e.telegram,whatsapp:e.whatsapp}}),g(!0),setTimeout(()=>g(!1),3e3)}catch(r){console.error("Ошибка сохранения контактов:",r),alert("Ошибка при сохранении контактов")}finally{k(!1)}};if(E)return s.jsx(U,{variant:"admin"});const W=m("workingSchedule")||M(),P=T(W),j=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],H=u.useMemo(()=>["Пн","Вт","Ср","Чт","Пт"],[]),b=(e,r)=>{const c=S("workingSchedule")?.[e];if(c)for(const d of r)p(`workingSchedule.${d}.closed`,!!c.closed,{shouldDirty:!0}),p(`workingSchedule.${d}.open`,c.open,{shouldDirty:!0}),p(`workingSchedule.${d}.close`,c.close,{shouldDirty:!0})},I=(e,r)=>{for(const n of e)p(`workingSchedule.${n}.closed`,r,{shouldDirty:!0})},v=e=>{const n=S("workingSchedule")?.[e];if(!n||n.closed)return!0;const c=String(n.open||""),d=String(n.close||"");return!c||!d?!1:c<d};return s.jsxs("div",{className:i.contacts,children:[s.jsx("h1",{className:i.title,children:"Редактирование контактов"}),s.jsxs(B,{className:i.card,children:[C&&s.jsx("div",{className:i.successMessage,children:"✓ Контакты успешно сохранены"}),s.jsxs("form",{onSubmit:$(N),className:i.form,children:[s.jsx(l,{label:"Телефон",...t("phone",{required:"Телефон обязателен"}),error:o.phone?.message}),s.jsx(l,{label:"WhatsApp номер (для wa.me, формат 7700..., без + и пробелов)",...t("whatsappPhone",{validate:e=>{if(!e)return!0;const r=String(e).replace(/\D/g,"");return r.length!==11?"Введите номер из 11 цифр (например 77001234567)":r.startsWith("7")?!0:"Номер должен начинаться с 7"}}),error:o.whatsappPhone?.message}),s.jsx(l,{label:"Email",type:"email",...t("email",{required:"Email обязателен"}),error:o.email?.message}),s.jsx(l,{label:"Адрес",...t("address",{required:"Адрес обязателен"}),error:o.address?.message}),s.jsx("h3",{className:i.sectionTitle,children:"График работы"}),s.jsxs("div",{style:{display:"flex",gap:10,flexWrap:"wrap",marginBottom:8},children:[s.jsx(h,{type:"button",size:"small",variant:"outline",onClick:()=>b("Пн",H),children:"Копировать Пн → Пн‑Пт"}),s.jsx(h,{type:"button",size:"small",variant:"outline",onClick:()=>b("Пн",j),children:"Копировать Пн → все дни"}),s.jsx(h,{type:"button",size:"small",variant:"outline",onClick:()=>I(["Сб","Вс"],!0),children:"Сделать Сб/Вс выходными"})]}),s.jsx("div",{style:{display:"grid",gap:10},children:j.map(e=>s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr 1fr 120px",gap:10,alignItems:"end"},children:[s.jsx("div",{style:{fontWeight:600,paddingBottom:8},children:e}),s.jsx(l,{label:"Открытие",type:"time",step:900,disabled:m(`workingSchedule.${e}.closed`),...t(`workingSchedule.${e}.open`,{required:!m(`workingSchedule.${e}.closed`),validate:()=>v(e)||"Открытие должно быть раньше закрытия"})}),s.jsx(l,{label:"Закрытие",type:"time",step:900,disabled:m(`workingSchedule.${e}.closed`),...t(`workingSchedule.${e}.close`,{required:!m(`workingSchedule.${e}.closed`),validate:()=>v(e)||"Закрытие должно быть позже открытия"})}),s.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center",paddingBottom:8},children:[s.jsx("input",{type:"checkbox",...t(`workingSchedule.${e}.closed`)}),"Выходной"]})]},e))}),s.jsxs("div",{style:{marginTop:8,opacity:.85},children:[s.jsx("strong",{children:"Как будет показано на сайте:"})," ",P]}),s.jsx(l,{label:"Ссылка для встраивания карты (iframe src)",type:"url",...t("mapEmbedUrl"),error:o.mapEmbedUrl?.message}),s.jsx("h3",{className:i.sectionTitle,children:"Социальные сети"}),s.jsx(l,{label:"Instagram",type:"url",...t("instagram"),error:o.instagram?.message}),s.jsx(l,{label:"VK",type:"url",...t("vk"),error:o.vk?.message}),s.jsx(l,{label:"Telegram",type:"url",...t("telegram"),error:o.telegram?.message}),s.jsx(l,{label:"WhatsApp",type:"url",...t("whatsapp"),error:o.whatsapp?.message}),s.jsx("div",{className:i.actions,children:s.jsx(h,{type:"submit",disabled:f,children:f?"Сохранение...":"Сохранить"})})]})]})]})};export{J as default};
