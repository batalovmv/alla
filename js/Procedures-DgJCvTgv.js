import{j as e,B as d,A as z,I as N,p as w}from"./index-DKxZk2j6.js";import{r as j}from"./react-vendor-BQWX9zlF.js";import{C as I}from"./Card-BwajGH-R.js";import{u as A,b as F}from"./form-vendor-BjD3cHyu.js";import{T as B}from"./Textarea-BIPiORF6.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-75UNovty.js";const P="_list_1lnt6_1",q="_item_1lnt6_7",E="_content_1lnt6_14",R="_image_1lnt6_21",T="_info_1lnt6_28",L="_name_1lnt6_32",V="_category_1lnt6_38",M="_price_1lnt6_44",G="_badge_1lnt6_51",H="_actions_1lnt6_62",J="_empty_1lnt6_67",c={list:P,item:q,content:E,image:R,info:T,name:L,category:V,price:M,badge:G,actions:H,empty:J},K=({procedures:s,onEdit:u,onDelete:o})=>s.length===0?e.jsx(I,{className:c.empty,children:e.jsx("p",{children:"Процедур пока нет. Добавьте первую процедуру."})}):e.jsx("div",{className:c.list,children:s.map(t=>e.jsxs(I,{className:c.item,children:[e.jsxs("div",{className:c.content,children:[t.images&&t.images.length>0&&e.jsx("img",{src:t.images[0],alt:t.name,className:c.image}),e.jsxs("div",{className:c.info,children:[e.jsx("h3",{className:c.name,children:t.name}),e.jsx("p",{className:c.category,children:t.category}),e.jsxs("p",{className:c.price,children:[t.price," ₽"]}),t.popular&&e.jsx("span",{className:c.badge,children:"Популярная"})]})]}),e.jsxs("div",{className:c.actions,children:[e.jsx(d,{size:"small",onClick:()=>u(t),children:"Редактировать"}),e.jsx(d,{size:"small",variant:"secondary",onClick:()=>o(t.id),children:"Удалить"})]})]},t.id))}),O="_imageUpload_2dtxu_1",Q="_images_2dtxu_5",W="_imageItem_2dtxu_12",X="_removeButton_2dtxu_27",Y="_uploadButton_2dtxu_50",Z="_hint_2dtxu_65",k={imageUpload:O,images:Q,imageItem:W,removeButton:X,uploadButton:Y,hint:Z},ee=({value:s=[],onChange:u,maxImages:o=5,folder:t="procedures"})=>{const[_,i]=j.useState(!1),g=j.useRef(null),l=async p=>{const r=p.target.files;if(!r||r.length===0)return;const b=o-s.length,f=Array.from(r).slice(0,b);if(f.length===0){alert(`Максимум ${o} изображений`);return}i(!0);try{const y=await z.uploadMultipleImages(f,t);u([...s,...y])}catch(y){console.error("Ошибка загрузки изображений:",y),alert("Ошибка при загрузке изображений")}finally{i(!1),g.current&&(g.current.value="")}},x=p=>{const r=s.filter((b,f)=>f!==p);u(r)};return e.jsxs("div",{className:k.imageUpload,children:[e.jsxs("div",{className:k.images,children:[s.map((p,r)=>e.jsxs("div",{className:k.imageItem,children:[e.jsx("img",{src:p,alt:`Изображение ${r+1}`}),e.jsx("button",{type:"button",className:k.removeButton,onClick:()=>x(r),children:"×"})]},r)),s.length<o&&e.jsxs("div",{className:k.uploadButton,children:[e.jsx("input",{ref:g,type:"file",accept:"image/*",multiple:!0,onChange:l,disabled:_,style:{display:"none"}}),e.jsx(d,{type:"button",size:"small",onClick:()=>g.current?.click(),disabled:_,children:_?"Загрузка...":"+ Добавить"})]})]}),s.length>=o&&e.jsxs("p",{className:k.hint,children:["Достигнут лимит изображений (",o,")"]})]})},se="_formContainer_1odik_1",ae="_card_1odik_5",te="_header_1odik_9",ie="_form_1odik_1",ne="_row_1odik_27",le="_field_1odik_33",re="_label_1odik_39",oe="_arrayItem_1odik_45",ce="_checkbox_1odik_55",de="_actions_1odik_65",n={formContainer:se,card:ae,header:te,form:ie,row:ne,field:le,label:re,arrayItem:oe,checkbox:ce,actions:de},me=({procedure:s,onClose:u,onSuccess:o})=>{const[t,_]=j.useState(!1),{register:i,handleSubmit:g,formState:{errors:l},control:x,setValue:p,watch:r}=A({defaultValues:{name:s?.name||"",category:s?.category||"",description:s?.description||"",fullDescription:s?.fullDescription||"",price:s?.price||0,duration:s?.duration||60,images:s?.images||[],indications:s?.indications?.map(a=>({value:a}))||[{value:""}],contraindications:s?.contraindications?.map(a=>({value:a}))||[{value:""}],popular:s?.popular||!1}}),{fields:b,append:f,remove:y}=F({control:x,name:"indications"}),{fields:h,append:S,remove:D}=F({control:x,name:"contraindications"}),$=r("images"),U=async a=>{_(!0);try{const m={name:a.name,category:a.category,description:a.description,fullDescription:a.fullDescription,price:Number(a.price),duration:Number(a.duration),images:a.images,indications:a.indications.map(v=>v.value).filter(v=>v.trim()),contraindications:a.contraindications.map(v=>v.value).filter(v=>v.trim()),popular:a.popular};s?await w.update(s.id,m):await w.create(m),o()}catch(m){console.error("Ошибка сохранения процедуры:",m),alert("Ошибка при сохранении процедуры")}finally{_(!1)}};return e.jsx("div",{className:n.formContainer,children:e.jsxs(I,{className:n.card,children:[e.jsxs("div",{className:n.header,children:[e.jsx("h2",{children:s?"Редактировать процедуру":"Добавить процедуру"}),e.jsx(d,{variant:"secondary",onClick:u,children:"×"})]}),e.jsxs("form",{onSubmit:g(U),className:n.form,children:[e.jsx(N,{label:"Название",...i("name",{required:"Название обязательно"}),error:l.name?.message}),e.jsx(N,{label:"Категория",...i("category",{required:"Категория обязательна"}),error:l.category?.message}),e.jsx(B,{label:"Краткое описание",rows:3,...i("description",{required:"Описание обязательно"}),error:l.description?.message}),e.jsx(B,{label:"Полное описание",rows:5,...i("fullDescription",{required:"Полное описание обязательно"}),error:l.fullDescription?.message}),e.jsxs("div",{className:n.row,children:[e.jsx(N,{label:"Цена (₽)",type:"number",...i("price",{required:"Цена обязательна",min:{value:0,message:"Цена должна быть положительной"},valueAsNumber:!0}),error:l.price?.message}),e.jsx(N,{label:"Длительность (минуты)",type:"number",...i("duration",{required:"Длительность обязательна",min:{value:1,message:"Минимум 1 минута"},valueAsNumber:!0}),error:l.duration?.message})]}),e.jsxs("div",{className:n.field,children:[e.jsx("label",{className:n.label,children:"Изображения"}),e.jsx(ee,{value:$,onChange:a=>p("images",a),maxImages:5,folder:"procedures"})]}),e.jsxs("div",{className:n.field,children:[e.jsx("label",{className:n.label,children:"Показания"}),b.map((a,m)=>e.jsxs("div",{className:n.arrayItem,children:[e.jsx(N,{...i(`indications.${m}.value`),placeholder:"Показание"}),e.jsx(d,{type:"button",variant:"secondary",size:"small",onClick:()=>y(m),children:"Удалить"})]},a.id)),e.jsx(d,{type:"button",variant:"outline",size:"small",onClick:()=>f({value:""}),children:"+ Добавить показание"})]}),e.jsxs("div",{className:n.field,children:[e.jsx("label",{className:n.label,children:"Противопоказания"}),h.map((a,m)=>e.jsxs("div",{className:n.arrayItem,children:[e.jsx(N,{...i(`contraindications.${m}.value`),placeholder:"Противопоказание"}),e.jsx(d,{type:"button",variant:"secondary",size:"small",onClick:()=>D(m),children:"Удалить"})]},a.id)),e.jsx(d,{type:"button",variant:"outline",size:"small",onClick:()=>S({value:""}),children:"+ Добавить противопоказание"})]}),e.jsxs("div",{className:n.checkbox,children:[e.jsx("input",{type:"checkbox",id:"popular",...i("popular")}),e.jsx("label",{htmlFor:"popular",children:"Популярная процедура"})]}),e.jsxs("div",{className:n.actions,children:[e.jsx(d,{type:"submit",disabled:t,children:t?"Сохранение...":"Сохранить"}),e.jsx(d,{type:"button",variant:"secondary",onClick:u,children:"Отмена"})]})]})]})})},ue="_procedures_a4r37_1",pe="_header_a4r37_5",he="_title_a4r37_12",_e="_loading_a4r37_17",C={procedures:ue,header:pe,title:he,loading:_e},Ne=()=>{const[s,u]=j.useState([]),[o,t]=j.useState(!0),[_,i]=j.useState(!1),[g,l]=j.useState(null);j.useEffect(()=>{x()},[]);const x=async()=>{try{t(!0);const h=await w.getAll();u(h)}catch(h){console.error("Ошибка загрузки процедур:",h)}finally{t(!1)}},p=()=>{l(null),i(!0)},r=h=>{l(h),i(!0)},b=async h=>{if(window.confirm("Вы уверены, что хотите удалить эту процедуру?"))try{await w.delete(h),await x()}catch(S){console.error("Ошибка удаления процедуры:",S),alert("Ошибка при удалении процедуры")}},f=()=>{i(!1),l(null)},y=()=>{i(!1),l(null),x()};return _?e.jsx(me,{procedure:g,onClose:f,onSuccess:y}):e.jsxs("div",{className:C.procedures,children:[e.jsxs("div",{className:C.header,children:[e.jsx("h1",{className:C.title,children:"Управление процедурами"}),e.jsx(d,{onClick:p,children:"+ Добавить процедуру"})]}),o?e.jsx("div",{className:C.loading,children:"Загрузка..."}):e.jsx(K,{procedures:s,onEdit:r,onDelete:b})]})};export{Ne as default};
