import{a as N,j as e,I as A,B as G,u as k,h as I,p as g,i as B,c as P,d as T}from"./index-BNwcWhVm.js";import{R as H,r as c}from"./react-vendor-BQWX9zlF.js";import{u as K,s as D,i as z,a as J}from"./useDelayedFlag-CNAZq2LX.js";import{S as F}from"./Select-EiEmReL5.js";import{u as U,C as Y}from"./form-vendor-BjD3cHyu.js";import{v as Q}from"./validation-tERvU4A4.js";import{T as W}from"./Textarea-BfABgum3.js";import{S as X}from"./SEO-Nim507aB.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-CGxEfUHl.js";const E="cosmetology_reviews",Z="1.0",ee=()=>{try{const r=localStorage.getItem(E);if(!r)return[];const a=JSON.parse(r);return a.version!==Z?a.reviews||[]:a.reviews||[]}catch(r){return console.error("Ошибка загрузки отзывов из localStorage:",r),[]}},se=r=>{const a=l=>{if(l.key===E&&l.newValue)try{const d=JSON.parse(l.newValue);r(d.reviews||[])}catch(d){console.error("Ошибка синхронизации отзывов:",d)}};return window.addEventListener("storage",a),()=>{window.removeEventListener("storage",a)}},te="_formContainer_137s1_1",ae="_title_137s1_9",re="_form_137s1_1",ie="_ratingSection_137s1_22",ne="_ratingLabel_137s1_28",oe="_required_137s1_34",ce="_ratingStars_137s1_39",le="_starLabel_137s1_46",de="_starInput_137s1_59",ue="_star_137s1_46",me="_errorMessage_137s1_79",he="_submitButton_137s1_85",o={formContainer:te,title:ae,form:re,ratingSection:ie,ratingLabel:ne,required:oe,ratingStars:ce,starLabel:le,starInput:de,star:ue,errorMessage:me,submitButton:he},ve=({onSubmit:r,isSubmitting:a=!1})=>{const{items:l}=N(i=>i.procedures),{register:d,handleSubmit:p,control:m,formState:{errors:n},reset:x}=U({defaultValues:{rating:5}}),f=c.useMemo(()=>l.map(i=>({value:i.id,label:i.name})),[l]),_=i=>{r(i),x()};return e.jsxs("div",{className:o.formContainer,children:[e.jsx("h3",{className:o.title,children:"Оставить отзыв"}),e.jsxs("form",{onSubmit:p(_),className:o.form,children:[e.jsx(A,{label:"Ваше имя",...d("clientName",{required:"Имя обязательно для заполнения",minLength:{value:2,message:"Имя должно содержать минимум 2 символа"},maxLength:{value:50,message:"Имя не должно превышать 50 символов"}}),error:n.clientName?.message}),e.jsx(A,{label:"Телефон (не публикуется, нужен для подтверждения)",type:"tel",...d("phone",{required:"Телефон обязателен для подтверждения",validate:i=>Q(i)||"Неверный формат телефона"}),error:n.phone?.message}),e.jsx(Y,{name:"procedureId",control:m,rules:{required:"Выберите процедуру"},render:({field:i})=>e.jsx(F,{label:"Процедура",options:f,...i,error:n.procedureId?.message})}),e.jsxs("div",{className:o.ratingSection,children:[e.jsxs("label",{className:o.ratingLabel,children:["Оценка ",e.jsx("span",{className:o.required,children:"*"})]}),e.jsx("div",{className:o.ratingStars,children:[5,4,3,2,1].map(i=>e.jsxs("label",{className:o.starLabel,children:[e.jsx("input",{type:"radio",value:i,...d("rating",{required:"Выберите оценку"}),className:o.starInput}),e.jsx("span",{className:o.star,children:"⭐"})]},i))}),n.rating&&e.jsx("span",{className:o.errorMessage,children:n.rating.message})]}),e.jsx(W,{label:"Ваш отзыв",...d("text",{required:"Отзыв обязателен для заполнения",minLength:{value:10,message:"Отзыв должен содержать минимум 10 символов"},maxLength:{value:1e3,message:"Отзыв не должен превышать 1000 символов"}}),error:n.text?.message,rows:5}),e.jsx(G,{type:"submit",size:"large",disabled:a,className:o.submitButton,children:a?"Отправка...":"Отправить отзыв"})]})]})},_e=H.memo(ve),ge="_reviews_2uvf8_1",pe="_container_2uvf8_6",xe="_title_2uvf8_11",fe="_header_2uvf8_19",we="_ratingSection_2uvf8_28",je="_averageRating_2uvf8_33",Ne="_ratingValue_2uvf8_40",Se="_stars_2uvf8_48",be="_ratingText_2uvf8_53",Re="_filter_2uvf8_59",ye="_reviewsGrid_2uvf8_65",Me="_reviewCard_2uvf8_71",Ce="_reviewHeader_2uvf8_78",Le="_reviewAuthor_2uvf8_85",Ae="_authorPhoto_2uvf8_92",Ie="_authorPlaceholder_2uvf8_99",Pe="_authorName_2uvf8_112",Te="_procedureName_2uvf8_119",Fe="_reviewRating_2uvf8_125",Ee="_reviewText_2uvf8_131",qe="_reviewDate_2uvf8_138",Oe="_empty_2uvf8_144",t={reviews:ge,container:pe,title:xe,header:fe,ratingSection:we,averageRating:je,ratingValue:Ne,stars:Se,ratingText:be,filter:Re,reviewsGrid:ye,reviewCard:Me,reviewHeader:Ce,reviewAuthor:Le,authorPhoto:Ae,authorPlaceholder:Ie,authorName:Pe,procedureName:Te,reviewRating:Fe,reviewText:Ee,reviewDate:qe,empty:Oe},Ye=()=>{const r=k(),{items:a,averageRating:l,lastFetched:d,loading:p}=N(s=>s.reviews),{items:m}=N(s=>s.procedures),[n,x]=c.useState(""),[f,_]=c.useState(!1),[i,S]=c.useState(null),b=!0,R=c.useRef("");c.useEffect(()=>{R.current=a.map(s=>`${s.id}:${s.approved===!0?"1":s.approved===!1?"0":"u"}`).join("|")},[a]),c.useEffect(()=>{(async()=>{r(P(!0));const u=ee(),w=3*60*1e3,$=[...a.length===0||z(d,w)?await J():[],...u],L=Array.from(new Map($.map(h=>[h.id,h])).values());L.map(h=>`${h.id}:${h.approved===!0?"1":h.approved===!1?"0":"u"}`).join("|")!==R.current&&r(T(L)),r(P(!1))})()},[r,b]),c.useEffect(()=>se(u=>{r(T(u))}),[r]);const q=c.useMemo(()=>[{value:"",label:"Все процедуры"},...m.map(s=>({value:s.id,label:s.name}))],[m]),v=c.useMemo(()=>a.filter(s=>s.approved===!0),[a]),y=c.useMemo(()=>n?v.filter(s=>s.procedureId===n):v,[v,n]),M=K(p&&a.length===0,160),O=c.useCallback(async s=>{_(!0),S(null);const w=m.find(C=>C.id===s.procedureId)?.name||"Неизвестная процедура",j=await D({clientName:s.clientName,phone:s.phone,procedureId:s.procedureId,procedureName:w,rating:s.rating,text:s.text});j.success,S(j.message),_(!1)},[r,m,a]),V=s=>{const u=Math.max(0,Math.min(5,Number.isFinite(s)?s:0));return"⭐".repeat(u)+"☆".repeat(5-u)};return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:"Отзывы",description:"Отзывы наших клиентов о косметологических процедурах. Реальные истории и результаты.",keywords:"отзывы косметология, отзывы клиентов, косметологические процедуры отзывы"}),e.jsx("div",{className:t.reviews,children:e.jsxs("div",{className:t.container,children:[e.jsx("h1",{className:t.title,children:"Отзывы клиентов"}),i&&e.jsx(I,{className:t.reviewCard,children:e.jsx("p",{children:i})}),e.jsx(_e,{onSubmit:O,isSubmitting:f}),M?e.jsxs("div",{className:t.header,children:[e.jsx("div",{className:t.ratingSection,children:e.jsxs("div",{className:t.averageRating,children:[e.jsx(g,{variant:"text",height:26,width:56}),e.jsx("div",{className:t.stars,style:{marginTop:6},children:e.jsx(g,{variant:"text",height:16,width:120})}),e.jsx("p",{className:t.ratingText,style:{marginTop:8},children:e.jsx(g,{variant:"text",height:12,width:180})})]})}),e.jsx("div",{className:t.filter,children:e.jsx(g,{height:56,radius:12})})]}):v.length>0?e.jsxs("div",{className:t.header,children:[e.jsx("div",{className:t.ratingSection,children:e.jsxs("div",{className:t.averageRating,children:[e.jsx("span",{className:t.ratingValue,children:l.toFixed(1)}),e.jsxs("div",{className:t.stars,children:["⭐".repeat(Math.max(0,Math.min(5,Math.round(l)))),"☆".repeat(5-Math.max(0,Math.min(5,Math.round(l))))]}),e.jsxs("p",{className:t.ratingText,children:["На основе ",v.length," отзывов"]})]})}),e.jsx("div",{className:t.filter,children:e.jsx(F,{label:"Фильтр по процедуре",options:q,value:n,onChange:s=>x(s.target.value)})})]}):null,M?e.jsx("div",{className:t.reviewsGrid,children:Array.from({length:6}).map((s,u)=>e.jsx(B,{},u))}):y.length>0?e.jsx("div",{className:t.reviewsGrid,children:y.map(s=>e.jsxs(I,{className:t.reviewCard,children:[e.jsxs("div",{className:t.reviewHeader,children:[e.jsxs("div",{className:t.reviewAuthor,children:[s.clientPhoto?e.jsx("img",{src:s.clientPhoto,alt:s.clientName,className:t.authorPhoto,loading:"lazy"}):e.jsx("div",{className:t.authorPlaceholder,children:s.clientName.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:t.authorName,children:s.clientName}),e.jsx("p",{className:t.procedureName,children:s.procedureName})]})]}),e.jsx("div",{className:t.reviewRating,children:V(s.rating)})]}),e.jsx("p",{className:t.reviewText,children:s.text}),e.jsx("p",{className:t.reviewDate,children:new Date(s.date).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})})]},s.id))}):e.jsx("div",{className:t.empty,children:e.jsx("p",{children:n?"Нет отзывов по выбранной процедуре":"Отзывов пока нет"})})]})})]})};export{Ye as default};
