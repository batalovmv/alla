import{a as N,j as e,I as M,B as O,u as V,k as C,b as L}from"./index-dp0cXq8c.js";import{R as $,r as o}from"./react-vendor-BQWX9zlF.js";import{s as B,i as G,a as k}from"./cache-BbjOkf0z.js";import{C as A}from"./Card-OJ_MDX0l.js";import{S as I}from"./Select-u612AmLa.js";import{u as H,C as K}from"./form-vendor-BjD3cHyu.js";import{v as z}from"./validation-tERvU4A4.js";import{T as D}from"./Textarea-B8rzs8_-.js";import{S as J}from"./SEO-CpioWFm_.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-CGxEfUHl.js";const P="cosmetology_reviews",U="1.0",Y=()=>{try{const r=localStorage.getItem(P);if(!r)return[];const a=JSON.parse(r);return a.version!==U?a.reviews||[]:a.reviews||[]}catch(r){return console.error("Ошибка загрузки отзывов из localStorage:",r),[]}},Q=r=>{const a=c=>{if(c.key===P&&c.newValue)try{const l=JSON.parse(c.newValue);r(l.reviews||[])}catch(l){console.error("Ошибка синхронизации отзывов:",l)}};return window.addEventListener("storage",a),()=>{window.removeEventListener("storage",a)}},W="_formContainer_137s1_1",X="_title_137s1_9",Z="_form_137s1_1",ee="_ratingSection_137s1_22",se="_ratingLabel_137s1_28",te="_required_137s1_34",re="_ratingStars_137s1_39",ae="_starLabel_137s1_46",ne="_starInput_137s1_59",ie="_star_137s1_46",oe="_errorMessage_137s1_79",ce="_submitButton_137s1_85",i={formContainer:W,title:X,form:Z,ratingSection:ee,ratingLabel:se,required:te,ratingStars:re,starLabel:ae,starInput:ne,star:ie,errorMessage:oe,submitButton:ce},le=({onSubmit:r,isSubmitting:a=!1})=>{const{items:c}=N(n=>n.procedures),{register:l,handleSubmit:v,control:u,formState:{errors:d},reset:x}=H({defaultValues:{rating:5}}),p=o.useMemo(()=>c.map(n=>({value:n.id,label:n.name})),[c]),g=n=>{r(n),x()};return e.jsxs("div",{className:i.formContainer,children:[e.jsx("h3",{className:i.title,children:"Оставить отзыв"}),e.jsxs("form",{onSubmit:v(g),className:i.form,children:[e.jsx(M,{label:"Ваше имя",...l("clientName",{required:"Имя обязательно для заполнения",minLength:{value:2,message:"Имя должно содержать минимум 2 символа"},maxLength:{value:50,message:"Имя не должно превышать 50 символов"}}),error:d.clientName?.message}),e.jsx(M,{label:"Телефон (не публикуется, нужен для подтверждения)",type:"tel",...l("phone",{required:"Телефон обязателен для подтверждения",validate:n=>z(n)||"Неверный формат телефона"}),error:d.phone?.message}),e.jsx(K,{name:"procedureId",control:u,rules:{required:"Выберите процедуру"},render:({field:n})=>e.jsx(I,{label:"Процедура",options:p,...n,error:d.procedureId?.message})}),e.jsxs("div",{className:i.ratingSection,children:[e.jsxs("label",{className:i.ratingLabel,children:["Оценка ",e.jsx("span",{className:i.required,children:"*"})]}),e.jsx("div",{className:i.ratingStars,children:[5,4,3,2,1].map(n=>e.jsxs("label",{className:i.starLabel,children:[e.jsx("input",{type:"radio",value:n,...l("rating",{required:"Выберите оценку"}),className:i.starInput}),e.jsx("span",{className:i.star,children:"⭐"})]},n))}),d.rating&&e.jsx("span",{className:i.errorMessage,children:d.rating.message})]}),e.jsx(D,{label:"Ваш отзыв",...l("text",{required:"Отзыв обязателен для заполнения",minLength:{value:10,message:"Отзыв должен содержать минимум 10 символов"},maxLength:{value:1e3,message:"Отзыв не должен превышать 1000 символов"}}),error:d.text?.message,rows:5}),e.jsx(O,{type:"submit",size:"large",disabled:a,className:i.submitButton,children:a?"Отправка...":"Отправить отзыв"})]})]})},de=$.memo(le),ue="_reviews_2uvf8_1",me="_container_2uvf8_6",ve="_title_2uvf8_11",he="_header_2uvf8_19",_e="_ratingSection_2uvf8_28",pe="_averageRating_2uvf8_33",ge="_ratingValue_2uvf8_40",xe="_stars_2uvf8_48",fe="_ratingText_2uvf8_53",we="_filter_2uvf8_59",Ne="_reviewsGrid_2uvf8_65",je="_reviewCard_2uvf8_71",Se="_reviewHeader_2uvf8_78",be="_reviewAuthor_2uvf8_85",Re="_authorPhoto_2uvf8_92",ye="_authorPlaceholder_2uvf8_99",Me="_authorName_2uvf8_112",Ce="_procedureName_2uvf8_119",Le="_reviewRating_2uvf8_125",Ae="_reviewText_2uvf8_131",Ie="_reviewDate_2uvf8_138",Pe="_empty_2uvf8_144",t={reviews:ue,container:me,title:ve,header:he,ratingSection:_e,averageRating:pe,ratingValue:ge,stars:xe,ratingText:fe,filter:we,reviewsGrid:Ne,reviewCard:je,reviewHeader:Se,reviewAuthor:be,authorPhoto:Re,authorPlaceholder:ye,authorName:Me,procedureName:Ce,reviewRating:Le,reviewText:Ae,reviewDate:Ie,empty:Pe},ze=()=>{const r=V(),{items:a,averageRating:c,lastFetched:l}=N(s=>s.reviews),{items:v}=N(s=>s.procedures),[u,d]=o.useState(""),[x,p]=o.useState(!1),[g,n]=o.useState(null),j=!0,S=o.useRef("");o.useEffect(()=>{S.current=a.map(s=>`${s.id}:${s.approved===!0?"1":s.approved===!1?"0":"u"}`).join("|")},[a]),o.useEffect(()=>{(async()=>{r(C(!0));const m=Y(),f=3*60*1e3,q=[...a.length===0||G(l,f)?await k():[],...m],y=Array.from(new Map(q.map(h=>[h.id,h])).values());y.map(h=>`${h.id}:${h.approved===!0?"1":h.approved===!1?"0":"u"}`).join("|")!==S.current&&r(L(y)),r(C(!1))})()},[r,j]),o.useEffect(()=>Q(m=>{r(L(m))}),[r]);const F=o.useMemo(()=>[{value:"",label:"Все процедуры"},...v.map(s=>({value:s.id,label:s.name}))],[v]),_=o.useMemo(()=>a.filter(s=>s.approved===!0),[a]),b=o.useMemo(()=>u?_.filter(s=>s.procedureId===u):_,[_,u]),E=o.useCallback(async s=>{p(!0),n(null);const f=v.find(R=>R.id===s.procedureId)?.name||"Неизвестная процедура",w=await B({clientName:s.clientName,phone:s.phone,procedureId:s.procedureId,procedureName:f,rating:s.rating,text:s.text});w.success,n(w.message),p(!1)},[r,v,a]),T=s=>{const m=Math.max(0,Math.min(5,Number.isFinite(s)?s:0));return"⭐".repeat(m)+"☆".repeat(5-m)};return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Отзывы",description:"Отзывы наших клиентов о косметологических процедурах. Реальные истории и результаты.",keywords:"отзывы косметология, отзывы клиентов, косметологические процедуры отзывы"}),e.jsx("div",{className:t.reviews,children:e.jsxs("div",{className:t.container,children:[e.jsx("h1",{className:t.title,children:"Отзывы клиентов"}),g&&e.jsx(A,{className:t.reviewCard,children:e.jsx("p",{children:g})}),e.jsx(de,{onSubmit:E,isSubmitting:x}),_.length>0&&e.jsxs("div",{className:t.header,children:[e.jsx("div",{className:t.ratingSection,children:e.jsxs("div",{className:t.averageRating,children:[e.jsx("span",{className:t.ratingValue,children:c.toFixed(1)}),e.jsxs("div",{className:t.stars,children:["⭐".repeat(Math.max(0,Math.min(5,Math.round(c)))),"☆".repeat(5-Math.max(0,Math.min(5,Math.round(c))))]}),e.jsxs("p",{className:t.ratingText,children:["На основе ",_.length," отзывов"]})]})}),e.jsx("div",{className:t.filter,children:e.jsx(I,{label:"Фильтр по процедуре",options:F,value:u,onChange:s=>d(s.target.value)})})]}),b.length>0?e.jsx("div",{className:t.reviewsGrid,children:b.map(s=>e.jsxs(A,{className:t.reviewCard,children:[e.jsxs("div",{className:t.reviewHeader,children:[e.jsxs("div",{className:t.reviewAuthor,children:[s.clientPhoto?e.jsx("img",{src:s.clientPhoto,alt:s.clientName,className:t.authorPhoto,loading:"lazy"}):e.jsx("div",{className:t.authorPlaceholder,children:s.clientName.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:t.authorName,children:s.clientName}),e.jsx("p",{className:t.procedureName,children:s.procedureName})]})]}),e.jsx("div",{className:t.reviewRating,children:T(s.rating)})]}),e.jsx("p",{className:t.reviewText,children:s.text}),e.jsx("p",{className:t.reviewDate,children:new Date(s.date).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})})]},s.id))}):e.jsx("div",{className:t.empty,children:e.jsx("p",{children:u?"Нет отзывов по выбранной процедуре":"Отзывов пока нет"})})]})})]})};export{ze as default};
