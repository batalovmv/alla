import{F as b,j as e,I as l,B as m,A as F}from"./index-OlKJmgfb.js";import{r}from"./react-vendor-BQWX9zlF.js";import{u as M,b as T}from"./form-vendor-BjD3cHyu.js";import{T as g}from"./Textarea-CduaHtuu.js";import{C as k}from"./Card-FPn4CWwW.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-75UNovty.js";const E="_about_4x7mz_1",U="_title_4x7mz_5",$="_loading_4x7mz_10",B="_card_4x7mz_15",L="_successMessage_4x7mz_19",R="_form_4x7mz_28",V="_field_4x7mz_34",D="_label_4x7mz_40",G="_photoPreview_4x7mz_46",H="_removePhoto_4x7mz_62",J="_hint_4x7mz_84",K="_arrayItem_4x7mz_90",O="_actions_4x7mz_100",t={about:E,title:U,loading:$,card:B,successMessage:L,form:R,field:V,label:D,photoPreview:G,removePhoto:H,hint:J,arrayItem:K,actions:O},te=()=>{const[j,d]=r.useState(!0),[u,p]=r.useState(!1),[v,c]=r.useState(!1),[h,f]=r.useState(!1),{register:o,handleSubmit:y,formState:{errors:i},control:z,setValue:x,watch:N,reset:S}=M({defaultValues:{name:"",photo:"",education:"",experience:"",description:"",certificates:[]}}),{fields:w,append:P,remove:C}=T({control:z,name:"certificates"}),_=N("photo");r.useEffect(()=>{I()},[]);const I=async()=>{try{d(!0);const s=await b.get();s&&S({name:s.name||"",photo:s.photo||"",education:s.education||"",experience:s.experience||"",description:s.description||"",certificates:s.certificates?.map(a=>({value:a}))||[]})}catch(s){console.error("Ошибка загрузки информации:",s)}finally{d(!1)}},q=async s=>{const a=s.target.files?.[0];if(a){f(!0);try{const n=await F.uploadImage(a,`about/${Date.now()}_${a.name}`);x("photo",n)}catch(n){console.error("Ошибка загрузки фото:",n),alert("Ошибка при загрузке фото")}finally{f(!1)}}},A=async s=>{p(!0),c(!1);try{await b.update({name:s.name,photo:s.photo,education:s.education,experience:s.experience,description:s.description,certificates:s.certificates.map(a=>a.value).filter(a=>a.trim())}),c(!0),setTimeout(()=>c(!1),3e3)}catch(a){console.error("Ошибка сохранения информации:",a),alert("Ошибка при сохранении информации")}finally{p(!1)}};return j?e.jsx("div",{className:t.loading,children:"Загрузка..."}):e.jsxs("div",{className:t.about,children:[e.jsx("h1",{className:t.title,children:'Редактирование "О специалисте"'}),e.jsxs(k,{className:t.card,children:[v&&e.jsx("div",{className:t.successMessage,children:"✓ Информация успешно сохранена"}),e.jsxs("form",{onSubmit:y(A),className:t.form,children:[e.jsx(l,{label:"Имя специалиста",...o("name",{required:"Имя обязательно"}),error:i.name?.message}),e.jsxs("div",{className:t.field,children:[e.jsx("label",{className:t.label,children:"Фото специалиста"}),_&&e.jsxs("div",{className:t.photoPreview,children:[e.jsx("img",{src:_,alt:"Фото специалиста"}),e.jsx("button",{type:"button",className:t.removePhoto,onClick:()=>x("photo",""),children:"×"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:q,disabled:h,style:{marginTop:"0.5rem"}}),h&&e.jsx("p",{className:t.hint,children:"Загрузка..."})]}),e.jsx(g,{label:"Образование",rows:3,...o("education",{required:"Образование обязательно"}),error:i.education?.message}),e.jsx(l,{label:"Опыт работы",...o("experience",{required:"Опыт работы обязателен"}),error:i.experience?.message}),e.jsx(g,{label:"Описание",rows:8,...o("description",{required:"Описание обязательно"}),error:i.description?.message}),e.jsxs("div",{className:t.field,children:[e.jsx("label",{className:t.label,children:"Сертификаты (ссылки)"}),w.map((s,a)=>e.jsxs("div",{className:t.arrayItem,children:[e.jsx(l,{...o(`certificates.${a}.value`),placeholder:"URL сертификата"}),e.jsx(m,{type:"button",variant:"secondary",size:"small",onClick:()=>C(a),children:"Удалить"})]},s.id)),e.jsx(m,{type:"button",variant:"outline",size:"small",onClick:()=>P({value:""}),children:"+ Добавить сертификат"})]}),e.jsx("div",{className:t.actions,children:e.jsx(m,{type:"submit",disabled:u,children:u?"Сохранение...":"Сохранить"})})]})]})]})};export{te as default};
