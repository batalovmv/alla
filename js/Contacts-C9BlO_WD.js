import{u as Z,a as H,C as ee,s as V,b as se,r as re,g as te,e as ae,f as ne,q as M,t as $,v as g,w as oe,j as e,h as z,B as I,I as x,S as le}from"./index-BDfGABa8.js";import{f as ce,r as o}from"./react-vendor-BQWX9zlF.js";import{u as ie,a as de,C as me}from"./form-vendor-BjD3cHyu.js";import{f as ue,i as he,c as pe,b as ge}from"./useInView-DFYTG8Fh.js";import{n as fe,f as y,v as xe,a as je}from"./validation-DcG8pJds.js";import{T as _e}from"./Textarea-0KApKewz.js";import{S as be}from"./Select-2cnSmmga.js";import{S as ye}from"./SEO-CL_QNVLe.js";import{R}from"./Reveal-Dl2UISRe.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-CGxEfUHl.js";const ve="_contacts_1nygq_1",ke="_container_1nygq_6",Ne="_title_1nygq_11",Me="_content_1nygq_19",Ie="_infoCard_1nygq_25",Se="_formCard_1nygq_26",qe="_contactItem_1nygq_37",we="_social_1nygq_63",Ce="_socialLinks_1nygq_75",Ee="_map_1nygq_91",Pe="_mapPlaceholder_1nygq_97",Te="_mapNote_1nygq_109",De="_form_1nygq_26",Be="_checkbox_1nygq_120",Ae="_successMessage_1nygq_138",Le="_errorMessage_1nygq_147",Xe="_submitButton_1nygq_153",r={contacts:ve,container:ke,title:Ne,content:Me,infoCard:Ie,formCard:Se,contactItem:qe,social:we,socialLinks:Ce,map:Ee,mapPlaceholder:Pe,mapNote:Te,form:De,checkbox:Be,successMessage:Ae,errorMessage:Le,submitButton:Xe},Je=()=>{const a=Z(),[S]=ce(),{items:c,lastFetched:q,loading:W}=H(s=>s.procedures),{isSubmitting:w,success:v,error:C}=H(s=>s.booking),[t,U]=o.useState({...ee,mapEmbedUrl:"",whatsappPhone:""}),{register:d,handleSubmit:O,formState:{errors:i},reset:E,setValue:u,control:P}=ie({defaultValues:{consent:!1}}),k=de({control:P,name:"procedureId"}),T=o.useCallback(async()=>{a(V(!0));try{const s=await ue();a(se(s))}finally{a(V(!1))}},[a]);o.useEffect(()=>{(c.length===0||he(q,3e5))&&T()},[c.length,q,T]),o.useEffect(()=>{const s=S.get("procedureId");if(s&&c.length>0&&c.some(l=>l.id===s)){const l=setTimeout(()=>{u("procedureId",s,{shouldValidate:!0,shouldDirty:!0})},0);return()=>clearTimeout(l)}},[S,c,u]),o.useEffect(()=>{if(v){E();const s=setTimeout(()=>{a(re())},5e3);return()=>clearTimeout(s)}},[v,E,a]),o.useEffect(()=>{let s=!0;return te().then(n=>{s&&U(n)}).catch(()=>{}),()=>{s=!1}},[]);const K=o.useMemo(()=>c.map(s=>({value:s.id,label:`${s.name} - ${s.price} ₽`})),[c]),N=o.useMemo(()=>k&&c.find(n=>n.id===k)?.name||"",[c,k]),j=o.useMemo(()=>{if(t.whatsappEnabled===!1)return null;const s="Здравствуйте! Хочу записаться в A.K.beauty.",n=N?`${s} Процедура: "${N}".`:s;return ae({whatsappPhone:t.whatsappPhone,text:n})},[t.whatsappEnabled,t.whatsappPhone,N]),h=o.useMemo(()=>ne({telegramLink:t.socialMedia.telegram}),[t.socialMedia.telegram]),D=o.useMemo(()=>M(t.socialMedia.instagram),[t.socialMedia.instagram]),B=o.useMemo(()=>M(t.socialMedia.vk),[t.socialMedia.vk]),A=o.useMemo(()=>M(t.socialMedia.whatsapp),[t.socialMedia.whatsapp]),G=o.useCallback(async s=>{const n=document.getElementById("hp_company")?.value;if(n&&n.trim().length>0){a($());return}const l=Date.now(),f=localStorage.getItem("booking_last_submit_ts"),_=f?Number(f):0;if(_&&l-_<6e4){a(g("Пожалуйста, подождите минуту и попробуйте снова."));return}a(oe());try{const m=fe(s.phone);if(!m){a(g("Укажите телефон в формате +7 (XXX) XXX-XX-XX"));return}const p=String(s.procedureId??"").trim();if(!p){a(g("Выберите процедуру."));return}const b=c.find(Y=>Y.id===p);if(!b){a(g("Выбранная процедура не найдена. Обновите страницу и попробуйте снова."));return}const X=(s.email??"").trim(),Q={...s,procedureId:p,phone:m,email:X||void 0},F=await pe({...Q,procedureName:b.name});F.success?(localStorage.setItem("booking_last_submit_ts",String(l)),a($())):a(g(F.message||"Ошибка отправки"))}catch(m){a(g(m instanceof Error?m.message:"Произошла ошибка"))}},[a]),L=t.mapEmbedUrl||"",J=ge(W&&c.length===0,160);return e.jsxs(e.Fragment,{children:[e.jsx(ye,{title:"Контакты и запись",description:"Свяжитесь с нами или запишитесь на консультацию. Телефон, адрес, форма записи на сеанс.",keywords:"контакты косметолог, запись на процедуру, косметология контакты"}),e.jsx("div",{className:r.contacts,children:e.jsxs("div",{className:r.container,children:[e.jsx("h1",{className:r.title,children:"Контакты и запись"}),e.jsxs("div",{className:r.content,children:[e.jsx("div",{className:r.infoSection,children:e.jsx(R,{children:e.jsxs(z,{className:r.infoCard,children:[e.jsx("h2",{children:"Контактная информация"}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Телефон:"}),e.jsx("a",{href:`tel:${t.phone}`,children:t.phone})]}),j&&e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"WhatsApp:"}),e.jsx("a",{href:j,target:"_blank",rel:"noopener noreferrer",children:"Написать в WhatsApp"})]}),h&&e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Telegram:"}),e.jsx("a",{href:h,target:"_blank",rel:"noopener noreferrer",children:"Написать в Telegram"})]}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Email:"}),e.jsx("a",{href:`mailto:${t.email}`,children:t.email})]}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Адрес:"}),e.jsx("p",{children:t.address})]}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Часы работы:"}),e.jsx("p",{children:t.workingHours})]}),e.jsxs("div",{className:r.social,children:[e.jsx("h3",{children:"Социальные сети"}),e.jsxs("div",{className:r.socialLinks,children:[D&&e.jsx("a",{href:D,target:"_blank",rel:"noopener noreferrer",children:"Instagram"}),B&&e.jsx("a",{href:B,target:"_blank",rel:"noopener noreferrer",children:"VK"}),h&&e.jsx("a",{href:h,target:"_blank",rel:"noopener noreferrer",children:"Telegram"}),A&&e.jsx("a",{href:A,target:"_blank",rel:"noopener noreferrer",children:"WhatsApp"})]})]}),e.jsx("div",{className:r.map,children:L?e.jsx("iframe",{title:"Карта",src:L,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",style:{width:"100%",height:320,border:0,borderRadius:12}}):e.jsxs("div",{className:r.mapPlaceholder,children:[e.jsx("p",{children:"Карта местоположения"}),e.jsx("p",{className:r.mapNote,children:"Укажите VITE_MAP_EMBED_URL в .env.local (или заполните ссылку в админке → Контакты), чтобы встроить карту"})]})})]})})}),e.jsx("div",{className:r.formSection,children:e.jsx(R,{delayMs:60,children:e.jsxs(z,{className:r.formCard,children:[e.jsx("h2",{children:"Записаться на сеанс"}),v&&e.jsxs("div",{className:r.successMessage,children:["✓ Ваша заявка успешно отправлена! Мы свяжемся с вами в ближайшее время.",j&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:j,target:"_blank",rel:"noopener noreferrer",children:e.jsx(I,{variant:"outline",size:"small",children:"Написать в WhatsApp сейчас"})})}),h&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:h,target:"_blank",rel:"noopener noreferrer",children:e.jsx(I,{variant:"outline",size:"small",children:"Написать в Telegram сейчас"})})})]}),C&&e.jsxs("div",{className:r.errorMessage,children:["✗ ",C]}),e.jsxs("form",{onSubmit:O(G),className:r.form,children:[e.jsx("input",{id:"hp_company",type:"text",tabIndex:-1,autoComplete:"off",style:{position:"absolute",left:"-10000px",top:"auto"},"aria-hidden":"true"}),e.jsx(x,{label:"Имя",...d("name",{required:"Имя обязательно для заполнения",minLength:{value:2,message:"Имя должно содержать минимум 2 символа"}}),error:i.name?.message}),e.jsx(x,{label:"Телефон",type:"tel",inputMode:"tel",autoComplete:"tel",placeholder:"+7 (999) 462-10-36",...d("phone",{required:"Телефон обязателен для заполнения",validate:s=>xe(s)||"Неверный формат телефона"}),onFocus:s=>{s.target.value||u("phone",y(""),{shouldDirty:!1})},onChange:s=>{const n=y(s.target.value);u("phone",n,{shouldValidate:!0,shouldDirty:!0})},onKeyDown:s=>{if(s.key!=="Backspace")return;const n=s.currentTarget,l=n.value||"",f=n.selectionStart??l.length,_=n.selectionEnd??l.length;if(f!==_||f!==l.length)return;const m=l[l.length-1]||"";if(![")","-"," "].includes(m))return;const p=l.replace(/\D/g,"");if(p.length<=1){s.preventDefault(),u("phone",y(""),{shouldValidate:!0,shouldDirty:!0});return}const b=p.slice(0,-1);s.preventDefault(),u("phone",y(b),{shouldValidate:!0,shouldDirty:!0})},error:i.phone?.message}),e.jsx(x,{label:"Email (необязательно)",type:"email",inputMode:"email",autoComplete:"email",placeholder:"name@example.com",...d("email",{validate:s=>!s||je(s)||"Неверный формат email"}),error:i.email?.message}),e.jsx(me,{name:"procedureId",control:P,rules:{required:"Выберите процедуру"},render:({field:s})=>J?e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("label",{style:{fontWeight:600,fontSize:14},children:"Процедура"}),e.jsx(le,{height:56,radius:12})]}):e.jsx(be,{label:"Процедура",options:K,...s,error:i.procedureId?.message})}),e.jsx(x,{label:"Желаемая дата",type:"date",...d("desiredDate",{required:"Укажите желаемую дату"}),error:i.desiredDate?.message}),e.jsx(x,{label:"Желаемое время",type:"time",...d("desiredTime",{required:"Укажите желаемое время"}),error:i.desiredTime?.message}),e.jsx(_e,{label:"Комментарий",...d("comment",{maxLength:{value:2e3,message:"Комментарий не должен превышать 2000 символов"}}),error:i.comment?.message}),e.jsxs("div",{className:r.checkbox,children:[e.jsx("input",{type:"checkbox",id:"consent",...d("consent",{required:"Необходимо согласие на обработку персональных данных"})}),e.jsxs("label",{htmlFor:"consent",children:["Я согласен(а) на обработку персональных данных."," ",e.jsx("a",{href:"/alla/privacy",target:"_blank",rel:"noopener noreferrer",children:"Политика конфиденциальности"})]}),i.consent&&e.jsx("span",{className:r.errorMessage,children:i.consent.message})]}),e.jsx(I,{type:"submit",size:"large",disabled:w,className:r.submitButton,children:w?"Отправка...":"Отправить заявку"})]})]})})})]})]})})]})};export{Je as default};
