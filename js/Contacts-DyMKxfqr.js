import{u as O,a as A,C as K,s as L,b as G,r as J,g as Q,e as X,f as Y,q as j,t as H,v as _,w as Z,j as e,h as F,B as b,I as u,S as ee}from"./index-Cc_lMNIn.js";import{f as se,r as t}from"./react-vendor-BQWX9zlF.js";import{u as re,a as ae,C as te}from"./form-vendor-BjD3cHyu.js";import{f as ne,i as oe,c as ce,b as le}from"./useInView-BP1nU54D.js";import{v as ie,a as de}from"./validation-tERvU4A4.js";import{T as me}from"./Textarea-Bj9686sj.js";import{S as he}from"./Select-v5XtonJb.js";import{S as ue}from"./SEO-jMRzTp8Z.js";import{R as $}from"./Reveal-BvsTEYmi.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-CGxEfUHl.js";const pe="_contacts_1nygq_1",ge="_container_1nygq_6",fe="_title_1nygq_11",xe="_content_1nygq_19",je="_infoCard_1nygq_25",_e="_formCard_1nygq_26",be="_contactItem_1nygq_37",ye="_social_1nygq_63",ve="_socialLinks_1nygq_75",ke="_map_1nygq_91",Ne="_mapPlaceholder_1nygq_97",Me="_mapNote_1nygq_109",Ie="_form_1nygq_26",Se="_checkbox_1nygq_120",qe="_successMessage_1nygq_138",we="_errorMessage_1nygq_147",Ee="_submitButton_1nygq_153",r={contacts:pe,container:ge,title:fe,content:xe,infoCard:je,formCard:_e,contactItem:be,social:ye,socialLinks:ve,map:ke,mapPlaceholder:Ne,mapNote:Me,form:Ie,checkbox:Se,successMessage:qe,errorMessage:we,submitButton:Ee},Re=()=>{const n=O(),[y]=se(),{items:o,lastFetched:v,loading:D}=A(s=>s.procedures),{isSubmitting:k,success:g,error:N}=A(s=>s.booking),[a,W]=t.useState({...K,mapEmbedUrl:"",whatsappPhone:""}),{register:i,handleSubmit:R,formState:{errors:c},reset:M,setValue:I,control:S}=re({defaultValues:{consent:!1}}),f=ae({control:S,name:"procedureId"}),q=t.useCallback(async()=>{n(L(!0));try{const s=await ne();n(G(s))}finally{n(L(!1))}},[n]);t.useEffect(()=>{(o.length===0||oe(v,3e5))&&q()},[o.length,v,q]),t.useEffect(()=>{const s=y.get("procedureId");if(s&&o.length>0&&o.some(m=>m.id===s)){const m=setTimeout(()=>{I("procedureId",s,{shouldValidate:!0,shouldDirty:!0})},0);return()=>clearTimeout(m)}},[y,o,I]),t.useEffect(()=>{if(g){M();const s=setTimeout(()=>{n(J())},5e3);return()=>clearTimeout(s)}},[g,M,n]),t.useEffect(()=>{let s=!0;return Q().then(l=>{s&&W(l)}).catch(()=>{}),()=>{s=!1}},[]);const z=t.useMemo(()=>o.map(s=>({value:s.id,label:`${s.name} - ${s.price} ₽`})),[o]),x=t.useMemo(()=>f&&o.find(l=>l.id===f)?.name||"",[o,f]),p=t.useMemo(()=>{if(a.whatsappEnabled===!1)return null;const s="Здравствуйте! Хочу записаться в A.K.beauty.",l=x?`${s} Процедура: "${x}".`:s;return X({whatsappPhone:a.whatsappPhone,text:l})},[a.whatsappEnabled,a.whatsappPhone,x]),d=t.useMemo(()=>Y({telegramLink:a.socialMedia.telegram}),[a.socialMedia.telegram]),w=t.useMemo(()=>j(a.socialMedia.instagram),[a.socialMedia.instagram]),E=t.useMemo(()=>j(a.socialMedia.vk),[a.socialMedia.vk]),C=t.useMemo(()=>j(a.socialMedia.whatsapp),[a.socialMedia.whatsapp]),U=t.useCallback(async s=>{const l=document.getElementById("hp_company")?.value;if(l&&l.trim().length>0){n(H());return}const m=Date.now(),T=localStorage.getItem("booking_last_submit_ts"),B=T?Number(T):0;if(B&&m-B<6e4){n(_("Пожалуйста, подождите минуту и попробуйте снова."));return}n(Z());try{const h=await ce(s);h.success?(localStorage.setItem("booking_last_submit_ts",String(m)),n(H())):n(_(h.message||"Ошибка отправки"))}catch(h){n(_(h instanceof Error?h.message:"Произошла ошибка"))}},[n]),P=a.mapEmbedUrl||"",V=le(D&&o.length===0,160);return e.jsxs(e.Fragment,{children:[e.jsx(ue,{title:"Контакты и запись",description:"Свяжитесь с нами или запишитесь на консультацию. Телефон, адрес, форма записи на сеанс.",keywords:"контакты косметолог, запись на процедуру, косметология контакты"}),e.jsx("div",{className:r.contacts,children:e.jsxs("div",{className:r.container,children:[e.jsx("h1",{className:r.title,children:"Контакты и запись"}),e.jsxs("div",{className:r.content,children:[e.jsx("div",{className:r.infoSection,children:e.jsx($,{children:e.jsxs(F,{className:r.infoCard,children:[e.jsx("h2",{children:"Контактная информация"}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Телефон:"}),e.jsx("a",{href:`tel:${a.phone}`,children:a.phone})]}),p&&e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"WhatsApp:"}),e.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",children:"Написать в WhatsApp"})]}),d&&e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Telegram:"}),e.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",children:"Написать в Telegram"})]}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Email:"}),e.jsx("a",{href:`mailto:${a.email}`,children:a.email})]}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Адрес:"}),e.jsx("p",{children:a.address})]}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Часы работы:"}),e.jsx("p",{children:a.workingHours})]}),e.jsxs("div",{className:r.social,children:[e.jsx("h3",{children:"Социальные сети"}),e.jsxs("div",{className:r.socialLinks,children:[w&&e.jsx("a",{href:w,target:"_blank",rel:"noopener noreferrer",children:"Instagram"}),E&&e.jsx("a",{href:E,target:"_blank",rel:"noopener noreferrer",children:"VK"}),d&&e.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",children:"Telegram"}),C&&e.jsx("a",{href:C,target:"_blank",rel:"noopener noreferrer",children:"WhatsApp"})]})]}),e.jsx("div",{className:r.map,children:P?e.jsx("iframe",{title:"Карта",src:P,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",style:{width:"100%",height:320,border:0,borderRadius:12}}):e.jsxs("div",{className:r.mapPlaceholder,children:[e.jsx("p",{children:"Карта местоположения"}),e.jsx("p",{className:r.mapNote,children:"Укажите VITE_MAP_EMBED_URL в .env.local (или заполните ссылку в админке → Контакты), чтобы встроить карту"})]})})]})})}),e.jsx("div",{className:r.formSection,children:e.jsx($,{delayMs:60,children:e.jsxs(F,{className:r.formCard,children:[e.jsx("h2",{children:"Записаться на сеанс"}),g&&e.jsxs("div",{className:r.successMessage,children:["✓ Ваша заявка успешно отправлена! Мы свяжемся с вами в ближайшее время.",p&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",children:e.jsx(b,{variant:"outline",size:"small",children:"Написать в WhatsApp сейчас"})})}),d&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",children:e.jsx(b,{variant:"outline",size:"small",children:"Написать в Telegram сейчас"})})})]}),N&&e.jsxs("div",{className:r.errorMessage,children:["✗ ",N]}),e.jsxs("form",{onSubmit:R(U),className:r.form,children:[e.jsx("input",{id:"hp_company",type:"text",tabIndex:-1,autoComplete:"off",style:{position:"absolute",left:"-10000px",top:"auto"},"aria-hidden":"true"}),e.jsx(u,{label:"Имя",...i("name",{required:"Имя обязательно для заполнения",minLength:{value:2,message:"Имя должно содержать минимум 2 символа"}}),error:c.name?.message}),e.jsx(u,{label:"Телефон",type:"tel",...i("phone",{required:"Телефон обязателен для заполнения",validate:s=>ie(s)||"Неверный формат телефона"}),error:c.phone?.message}),e.jsx(u,{label:"Email",type:"email",...i("email",{validate:s=>!s||de(s)||"Неверный формат email"}),error:c.email?.message}),e.jsx(te,{name:"procedureId",control:S,rules:{required:"Выберите процедуру"},render:({field:s})=>V?e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("label",{style:{fontWeight:600,fontSize:14},children:"Процедура"}),e.jsx(ee,{height:56,radius:12})]}):e.jsx(he,{label:"Процедура",options:z,...s,error:c.procedureId?.message})}),e.jsx(u,{label:"Желаемая дата",type:"date",...i("desiredDate",{required:"Укажите желаемую дату"}),error:c.desiredDate?.message}),e.jsx(u,{label:"Желаемое время",type:"time",...i("desiredTime",{required:"Укажите желаемое время"}),error:c.desiredTime?.message}),e.jsx(me,{label:"Комментарий",...i("comment",{maxLength:{value:2e3,message:"Комментарий не должен превышать 2000 символов"}}),error:c.comment?.message}),e.jsxs("div",{className:r.checkbox,children:[e.jsx("input",{type:"checkbox",id:"consent",...i("consent",{required:"Необходимо согласие на обработку персональных данных"})}),e.jsxs("label",{htmlFor:"consent",children:["Я согласен(а) на обработку персональных данных."," ",e.jsx("a",{href:"/alla/privacy",target:"_blank",rel:"noopener noreferrer",children:"Политика конфиденциальности"})]}),c.consent&&e.jsx("span",{className:r.errorMessage,children:c.consent.message})]}),e.jsx(b,{type:"submit",size:"large",disabled:k,className:r.submitButton,children:k?"Отправка...":"Отправить заявку"})]})]})})})]})]})})]})};export{Re as default};
