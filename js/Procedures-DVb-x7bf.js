import{j as e,h as I,B as d,J as U,I as N,x as C,p as z}from"./index-_3K3tdZ7.js";import{r as j}from"./react-vendor-BQWX9zlF.js";import{u as q,b as F}from"./form-vendor-BjD3cHyu.js";import{T as B}from"./Textarea--bXiF8wP.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-CGxEfUHl.js";const A="_list_1lnt6_1",E="_item_1lnt6_7",R="_content_1lnt6_14",T="_image_1lnt6_21",L="_info_1lnt6_28",V="_name_1lnt6_32",J="_category_1lnt6_38",M="_price_1lnt6_44",G="_badge_1lnt6_51",H="_actions_1lnt6_62",K="_empty_1lnt6_67",c={list:A,item:E,content:R,image:T,info:L,name:V,category:J,price:M,badge:G,actions:H,empty:K},O=({procedures:s,onEdit:u,onDelete:o})=>s.length===0?e.jsx(I,{className:c.empty,children:e.jsx("p",{children:"Процедур пока нет. Добавьте первую процедуру."})}):e.jsx("div",{className:c.list,children:s.map(t=>e.jsxs(I,{className:c.item,children:[e.jsxs("div",{className:c.content,children:[t.images&&t.images.length>0&&e.jsx("img",{src:t.images[0],alt:t.name,className:c.image}),e.jsxs("div",{className:c.info,children:[e.jsx("h3",{className:c.name,children:t.name}),e.jsx("p",{className:c.category,children:t.category}),e.jsxs("p",{className:c.price,children:[t.price," ₽"]}),t.popular&&e.jsx("span",{className:c.badge,children:"Популярная"})]})]}),e.jsxs("div",{className:c.actions,children:[e.jsx(d,{size:"small",onClick:()=>u(t),children:"Редактировать"}),e.jsx(d,{size:"small",variant:"secondary",onClick:()=>o(t.id),children:"Удалить"})]})]},t.id))}),Q="_imageUpload_2dtxu_1",W="_images_2dtxu_5",X="_imageItem_2dtxu_12",Y="_removeButton_2dtxu_27",Z="_uploadButton_2dtxu_50",ee="_hint_2dtxu_65",k={imageUpload:Q,images:W,imageItem:X,removeButton:Y,uploadButton:Z,hint:ee},se=({value:s=[],onChange:u,maxImages:o=5,folder:t="procedures"})=>{const[_,i]=j.useState(!1),x=j.useRef(null),l=async p=>{const r=p.target.files;if(!r||r.length===0)return;const v=o-s.length,f=Array.from(r).slice(0,v);if(f.length===0){alert(`Максимум ${o} изображений`);return}i(!0);try{const y=await U.uploadMultipleImages(f,t);u([...s,...y])}catch(y){console.error("Ошибка загрузки изображений:",y),alert("Ошибка при загрузке изображений")}finally{i(!1),x.current&&(x.current.value="")}},g=p=>{const r=s.filter((v,f)=>f!==p);u(r)};return e.jsxs("div",{className:k.imageUpload,children:[e.jsxs("div",{className:k.images,children:[s.map((p,r)=>e.jsxs("div",{className:k.imageItem,children:[e.jsx("img",{src:p,alt:`Изображение ${r+1}`}),e.jsx("button",{type:"button",className:k.removeButton,onClick:()=>g(r),children:"×"})]},r)),s.length<o&&e.jsxs("div",{className:k.uploadButton,children:[e.jsx("input",{ref:x,type:"file",accept:"image/*",multiple:!0,onChange:l,disabled:_,style:{display:"none"}}),e.jsx(d,{type:"button",size:"small",onClick:()=>x.current?.click(),disabled:_,children:_?"Загрузка...":"+ Добавить"})]})]}),s.length>=o&&e.jsxs("p",{className:k.hint,children:["Достигнут лимит изображений (",o,")"]})]})},ae="_formContainer_1odik_1",te="_card_1odik_5",ie="_header_1odik_9",ne="_form_1odik_1",le="_row_1odik_27",re="_field_1odik_33",oe="_label_1odik_39",ce="_arrayItem_1odik_45",de="_checkbox_1odik_55",me="_actions_1odik_65",n={formContainer:ae,card:te,header:ie,form:ne,row:le,field:re,label:oe,arrayItem:ce,checkbox:de,actions:me},ue=({procedure:s,onClose:u,onSuccess:o})=>{const[t,_]=j.useState(!1),{register:i,handleSubmit:x,formState:{errors:l},control:g,setValue:p,watch:r}=q({defaultValues:{name:s?.name||"",category:s?.category||"",description:s?.description||"",fullDescription:s?.fullDescription||"",price:s?.price||0,duration:s?.duration||60,images:s?.images||[],indications:s?.indications?.map(a=>({value:a}))||[{value:""}],contraindications:s?.contraindications?.map(a=>({value:a}))||[{value:""}],popular:s?.popular||!1}}),{fields:v,append:f,remove:y}=F({control:g,name:"indications"}),{fields:h,append:w,remove:D}=F({control:g,name:"contraindications"}),$=r("images"),P=async a=>{_(!0);try{const m={name:a.name,category:a.category,description:a.description,fullDescription:a.fullDescription,price:Number(a.price),duration:Number(a.duration),images:a.images,indications:a.indications.map(b=>b.value).filter(b=>b.trim()),contraindications:a.contraindications.map(b=>b.value).filter(b=>b.trim()),popular:a.popular};s?await C.update(s.id,m):await C.create(m),o()}catch(m){console.error("Ошибка сохранения процедуры:",m),alert("Ошибка при сохранении процедуры")}finally{_(!1)}};return e.jsx("div",{className:n.formContainer,children:e.jsxs(I,{className:n.card,children:[e.jsxs("div",{className:n.header,children:[e.jsx("h2",{children:s?"Редактировать процедуру":"Добавить процедуру"}),e.jsx(d,{variant:"secondary",onClick:u,children:"×"})]}),e.jsxs("form",{onSubmit:x(P),className:n.form,children:[e.jsx(N,{label:"Название",...i("name",{required:"Название обязательно"}),error:l.name?.message}),e.jsx(N,{label:"Категория",...i("category",{required:"Категория обязательна"}),error:l.category?.message}),e.jsx(B,{label:"Краткое описание",rows:3,...i("description",{required:"Описание обязательно"}),error:l.description?.message}),e.jsx(B,{label:"Полное описание",rows:5,...i("fullDescription",{required:"Полное описание обязательно"}),error:l.fullDescription?.message}),e.jsxs("div",{className:n.row,children:[e.jsx(N,{label:"Цена (₽)",type:"number",...i("price",{required:"Цена обязательна",min:{value:0,message:"Цена должна быть положительной"},valueAsNumber:!0}),error:l.price?.message}),e.jsx(N,{label:"Длительность (минуты)",type:"number",...i("duration",{required:"Длительность обязательна",min:{value:1,message:"Минимум 1 минута"},valueAsNumber:!0}),error:l.duration?.message})]}),e.jsxs("div",{className:n.field,children:[e.jsx("label",{className:n.label,children:"Изображения"}),e.jsx(se,{value:$,onChange:a=>p("images",a),maxImages:5,folder:"procedures"})]}),e.jsxs("div",{className:n.field,children:[e.jsx("label",{className:n.label,children:"Показания"}),v.map((a,m)=>e.jsxs("div",{className:n.arrayItem,children:[e.jsx(N,{...i(`indications.${m}.value`),placeholder:"Показание"}),e.jsx(d,{type:"button",variant:"secondary",size:"small",onClick:()=>y(m),children:"Удалить"})]},a.id)),e.jsx(d,{type:"button",variant:"outline",size:"small",onClick:()=>f({value:""}),children:"+ Добавить показание"})]}),e.jsxs("div",{className:n.field,children:[e.jsx("label",{className:n.label,children:"Противопоказания"}),h.map((a,m)=>e.jsxs("div",{className:n.arrayItem,children:[e.jsx(N,{...i(`contraindications.${m}.value`),placeholder:"Противопоказание"}),e.jsx(d,{type:"button",variant:"secondary",size:"small",onClick:()=>D(m),children:"Удалить"})]},a.id)),e.jsx(d,{type:"button",variant:"outline",size:"small",onClick:()=>w({value:""}),children:"+ Добавить противопоказание"})]}),e.jsxs("div",{className:n.checkbox,children:[e.jsx("input",{type:"checkbox",id:"popular",...i("popular")}),e.jsx("label",{htmlFor:"popular",children:"Популярная процедура"})]}),e.jsxs("div",{className:n.actions,children:[e.jsx(d,{type:"submit",disabled:t,children:t?"Сохранение...":"Сохранить"}),e.jsx(d,{type:"button",variant:"secondary",onClick:u,children:"Отмена"})]})]})]})})},pe="_procedures_a4r37_1",he="_header_a4r37_5",_e="_title_a4r37_12",S={procedures:pe,header:he,title:_e},ve=()=>{const[s,u]=j.useState([]),[o,t]=j.useState(!0),[_,i]=j.useState(!1),[x,l]=j.useState(null);j.useEffect(()=>{g()},[]);const g=async()=>{try{t(!0);const h=await C.getAll();u(h)}catch(h){console.error("Ошибка загрузки процедур:",h)}finally{t(!1)}},p=()=>{l(null),i(!0)},r=h=>{l(h),i(!0)},v=async h=>{if(window.confirm("Вы уверены, что хотите удалить эту процедуру?"))try{await C.delete(h),await g()}catch(w){console.error("Ошибка удаления процедуры:",w),alert("Ошибка при удалении процедуры")}},f=()=>{i(!1),l(null)},y=()=>{i(!1),l(null),g()};return _?e.jsx(ue,{procedure:x,onClose:f,onSuccess:y}):e.jsxs("div",{className:S.procedures,children:[e.jsxs("div",{className:S.header,children:[e.jsx("h1",{className:S.title,children:"Управление процедурами"}),e.jsx(d,{onClick:p,children:"+ Добавить процедуру"})]}),o?e.jsx(z,{variant:"admin"}):e.jsx(O,{procedures:s,onEdit:r,onDelete:v})]})};export{ve as default};
