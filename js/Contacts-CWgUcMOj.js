import{u as O,a as A,C as R,s as L,b as K,r as G,g as J,e as Q,f as X,q as _,t as H,v as j,w as Y,j as e,h as F,B as b,I as u,p as Z}from"./index-BNwcWhVm.js";import{f as ee,r as t}from"./react-vendor-BQWX9zlF.js";import{u as se,a as re,C as ae}from"./form-vendor-BjD3cHyu.js";import{f as te,i as ne,b as oe,u as ce}from"./useDelayedFlag-CNAZq2LX.js";import{v as ie,a as le}from"./validation-tERvU4A4.js";import{T as de}from"./Textarea-BfABgum3.js";import{S as me}from"./Select-EiEmReL5.js";import{S as he}from"./SEO-Nim507aB.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-CGxEfUHl.js";const ue="_contacts_1nygq_1",pe="_container_1nygq_6",ge="_title_1nygq_11",fe="_content_1nygq_19",xe="_infoCard_1nygq_25",_e="_formCard_1nygq_26",je="_contactItem_1nygq_37",be="_social_1nygq_63",ye="_socialLinks_1nygq_75",ve="_map_1nygq_91",ke="_mapPlaceholder_1nygq_97",Ne="_mapNote_1nygq_109",Ie="_form_1nygq_26",Me="_checkbox_1nygq_120",Se="_successMessage_1nygq_138",qe="_errorMessage_1nygq_147",we="_submitButton_1nygq_153",r={contacts:ue,container:pe,title:ge,content:fe,infoCard:xe,formCard:_e,contactItem:je,social:be,socialLinks:ye,map:ve,mapPlaceholder:ke,mapNote:Ne,form:Ie,checkbox:Me,successMessage:Se,errorMessage:qe,submitButton:we},De=()=>{const n=O(),[y]=ee(),{items:o,lastFetched:v,loading:$}=A(s=>s.procedures),{isSubmitting:k,success:g,error:N}=A(s=>s.booking),[a,D]=t.useState({...R,mapEmbedUrl:"",whatsappPhone:""}),{register:l,handleSubmit:W,formState:{errors:c},reset:I,setValue:M,control:S}=se({defaultValues:{consent:!1}}),f=re({control:S,name:"procedureId"}),q=t.useCallback(async()=>{n(L(!0));try{const s=await te();n(K(s))}finally{n(L(!1))}},[n]);t.useEffect(()=>{(o.length===0||ne(v,3e5))&&q()},[o.length,v,q]),t.useEffect(()=>{const s=y.get("procedureId");if(s&&o.length>0&&o.some(m=>m.id===s)){const m=setTimeout(()=>{M("procedureId",s,{shouldValidate:!0,shouldDirty:!0})},0);return()=>clearTimeout(m)}},[y,o,M]),t.useEffect(()=>{if(g){I();const s=setTimeout(()=>{n(G())},5e3);return()=>clearTimeout(s)}},[g,I,n]),t.useEffect(()=>{let s=!0;return J().then(i=>{s&&D(i)}).catch(()=>{}),()=>{s=!1}},[]);const z=t.useMemo(()=>o.map(s=>({value:s.id,label:`${s.name} - ${s.price} ₽`})),[o]),x=t.useMemo(()=>f&&o.find(i=>i.id===f)?.name||"",[o,f]),p=t.useMemo(()=>{if(a.whatsappEnabled===!1)return null;const s="Здравствуйте! Хочу записаться в A.K.beauty.",i=x?`${s} Процедура: "${x}".`:s;return Q({whatsappPhone:a.whatsappPhone,text:i})},[a.whatsappEnabled,a.whatsappPhone,x]),d=t.useMemo(()=>X({telegramLink:a.socialMedia.telegram}),[a.socialMedia.telegram]),w=t.useMemo(()=>_(a.socialMedia.instagram),[a.socialMedia.instagram]),E=t.useMemo(()=>_(a.socialMedia.vk),[a.socialMedia.vk]),C=t.useMemo(()=>_(a.socialMedia.whatsapp),[a.socialMedia.whatsapp]),U=t.useCallback(async s=>{const i=document.getElementById("hp_company")?.value;if(i&&i.trim().length>0){n(H());return}const m=Date.now(),T=localStorage.getItem("booking_last_submit_ts"),B=T?Number(T):0;if(B&&m-B<6e4){n(j("Пожалуйста, подождите минуту и попробуйте снова."));return}n(Y());try{const h=await oe(s);h.success?(localStorage.setItem("booking_last_submit_ts",String(m)),n(H())):n(j(h.message||"Ошибка отправки"))}catch(h){n(j(h instanceof Error?h.message:"Произошла ошибка"))}},[n]),P=a.mapEmbedUrl||"",V=ce($&&o.length===0,160);return e.jsxs(e.Fragment,{children:[e.jsx(he,{title:"Контакты и запись",description:"Свяжитесь с нами или запишитесь на консультацию. Телефон, адрес, форма записи на сеанс.",keywords:"контакты косметолог, запись на процедуру, косметология контакты"}),e.jsx("div",{className:r.contacts,children:e.jsxs("div",{className:r.container,children:[e.jsx("h1",{className:r.title,children:"Контакты и запись"}),e.jsxs("div",{className:r.content,children:[e.jsx("div",{className:r.infoSection,children:e.jsxs(F,{className:r.infoCard,children:[e.jsx("h2",{children:"Контактная информация"}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Телефон:"}),e.jsx("a",{href:`tel:${a.phone}`,children:a.phone})]}),p&&e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"WhatsApp:"}),e.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",children:"Написать в WhatsApp"})]}),d&&e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Telegram:"}),e.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",children:"Написать в Telegram"})]}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Email:"}),e.jsx("a",{href:`mailto:${a.email}`,children:a.email})]}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Адрес:"}),e.jsx("p",{children:a.address})]}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Часы работы:"}),e.jsx("p",{children:a.workingHours})]}),e.jsxs("div",{className:r.social,children:[e.jsx("h3",{children:"Социальные сети"}),e.jsxs("div",{className:r.socialLinks,children:[w&&e.jsx("a",{href:w,target:"_blank",rel:"noopener noreferrer",children:"Instagram"}),E&&e.jsx("a",{href:E,target:"_blank",rel:"noopener noreferrer",children:"VK"}),d&&e.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",children:"Telegram"}),C&&e.jsx("a",{href:C,target:"_blank",rel:"noopener noreferrer",children:"WhatsApp"})]})]}),e.jsx("div",{className:r.map,children:P?e.jsx("iframe",{title:"Карта",src:P,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",style:{width:"100%",height:320,border:0,borderRadius:12}}):e.jsxs("div",{className:r.mapPlaceholder,children:[e.jsx("p",{children:"Карта местоположения"}),e.jsx("p",{className:r.mapNote,children:"Укажите VITE_MAP_EMBED_URL в .env.local (или заполните ссылку в админке → Контакты), чтобы встроить карту"})]})})]})}),e.jsx("div",{className:r.formSection,children:e.jsxs(F,{className:r.formCard,children:[e.jsx("h2",{children:"Записаться на сеанс"}),g&&e.jsxs("div",{className:r.successMessage,children:["✓ Ваша заявка успешно отправлена! Мы свяжемся с вами в ближайшее время.",p&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",children:e.jsx(b,{variant:"outline",size:"small",children:"Написать в WhatsApp сейчас"})})}),d&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",children:e.jsx(b,{variant:"outline",size:"small",children:"Написать в Telegram сейчас"})})})]}),N&&e.jsxs("div",{className:r.errorMessage,children:["✗ ",N]}),e.jsxs("form",{onSubmit:W(U),className:r.form,children:[e.jsx("input",{id:"hp_company",type:"text",tabIndex:-1,autoComplete:"off",style:{position:"absolute",left:"-10000px",top:"auto"},"aria-hidden":"true"}),e.jsx(u,{label:"Имя",...l("name",{required:"Имя обязательно для заполнения",minLength:{value:2,message:"Имя должно содержать минимум 2 символа"}}),error:c.name?.message}),e.jsx(u,{label:"Телефон",type:"tel",...l("phone",{required:"Телефон обязателен для заполнения",validate:s=>ie(s)||"Неверный формат телефона"}),error:c.phone?.message}),e.jsx(u,{label:"Email",type:"email",...l("email",{validate:s=>!s||le(s)||"Неверный формат email"}),error:c.email?.message}),e.jsx(ae,{name:"procedureId",control:S,rules:{required:"Выберите процедуру"},render:({field:s})=>V?e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("label",{style:{fontWeight:600,fontSize:14},children:"Процедура"}),e.jsx(Z,{height:56,radius:12})]}):e.jsx(me,{label:"Процедура",options:z,...s,error:c.procedureId?.message})}),e.jsx(u,{label:"Желаемая дата",type:"date",...l("desiredDate",{required:"Укажите желаемую дату"}),error:c.desiredDate?.message}),e.jsx(u,{label:"Желаемое время",type:"time",...l("desiredTime",{required:"Укажите желаемое время"}),error:c.desiredTime?.message}),e.jsx(de,{label:"Комментарий",...l("comment",{maxLength:{value:2e3,message:"Комментарий не должен превышать 2000 символов"}}),error:c.comment?.message}),e.jsxs("div",{className:r.checkbox,children:[e.jsx("input",{type:"checkbox",id:"consent",...l("consent",{required:"Необходимо согласие на обработку персональных данных"})}),e.jsxs("label",{htmlFor:"consent",children:["Я согласен(а) на обработку персональных данных."," ",e.jsx("a",{href:"/alla/privacy",target:"_blank",rel:"noopener noreferrer",children:"Политика конфиденциальности"})]}),c.consent&&e.jsx("span",{className:r.errorMessage,children:c.consent.message})]}),e.jsx(b,{type:"submit",size:"large",disabled:k,className:r.submitButton,children:k?"Отправка...":"Отправить заявку"})]})]})})]})]})})]})};export{De as default};
