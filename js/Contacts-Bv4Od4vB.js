import{u as ee,a as $,C as se,s as V,b as re,r as te,g as ae,e as ne,f as oe,q as M,t as u,v as le,w as ce,j as e,h as z,B as S,I as x,S as ie}from"./index-ClPW3n0f.js";import{f as de,r as n}from"./react-vendor-BQWX9zlF.js";import{u as me,a as ue,C as he}from"./form-vendor-BjD3cHyu.js";import{f as pe,i as ge,c as fe,b as xe}from"./useInView-ZdEbPg_V.js";import{n as je,f as y,v as _e,a as be}from"./validation-DcG8pJds.js";import{T as ye}from"./Textarea-nTcPL08V.js";import{S as ve}from"./Select-CRQ33zcK.js";import{S as ke}from"./SEO-Bdtsfrtw.js";import{R as W}from"./Reveal-CxuTswIv.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-CGxEfUHl.js";const Ne="_contacts_1nygq_1",Me="_container_1nygq_6",Se="_title_1nygq_11",Ie="_content_1nygq_19",qe="_infoCard_1nygq_25",we="_formCard_1nygq_26",Ce="_contactItem_1nygq_37",Ee="_social_1nygq_63",Pe="_socialLinks_1nygq_75",Te="_map_1nygq_91",De="_mapPlaceholder_1nygq_97",Be="_mapNote_1nygq_109",Ae="_form_1nygq_26",Le="_checkbox_1nygq_120",Xe="_successMessage_1nygq_138",Fe="_errorMessage_1nygq_147",He="_submitButton_1nygq_153",r={contacts:Ne,container:Me,title:Se,content:Ie,infoCard:qe,formCard:we,contactItem:Ce,social:Ee,socialLinks:Pe,map:Te,mapPlaceholder:De,mapNote:Be,form:Ae,checkbox:Le,successMessage:Xe,errorMessage:Fe,submitButton:He},Ye=()=>{const a=ee(),[I]=de(),{items:c,lastFetched:q,loading:U}=$(s=>s.procedures),{isSubmitting:w,success:v,error:C}=$(s=>s.booking),[t,O]=n.useState({...se,mapEmbedUrl:"",whatsappPhone:""}),{register:d,handleSubmit:K,formState:{errors:i},reset:E,setValue:h,control:P}=me({defaultValues:{consent:!1}}),k=ue({control:P,name:"procedureId"}),T=n.useRef(null),D=n.useMemo(()=>`hp_${Math.random().toString(36).slice(2)}`,[]),B=n.useCallback(async()=>{a(V(!0));try{const s=await pe();a(re(s))}finally{a(V(!1))}},[a]);n.useEffect(()=>{(c.length===0||ge(q,3e5))&&B()},[c.length,q,B]),n.useEffect(()=>{const s=I.get("procedureId");if(s&&c.length>0&&c.some(l=>l.id===s)){const l=setTimeout(()=>{h("procedureId",s,{shouldValidate:!0,shouldDirty:!0})},0);return()=>clearTimeout(l)}},[I,c,h]),n.useEffect(()=>{if(v){E();const s=setTimeout(()=>{a(te())},5e3);return()=>clearTimeout(s)}},[v,E,a]),n.useEffect(()=>{let s=!0;return ae().then(o=>{s&&O(o)}).catch(()=>{}),()=>{s=!1}},[]);const G=n.useMemo(()=>c.map(s=>({value:s.id,label:`${s.name} - ${s.price} ₽`})),[c]),N=n.useMemo(()=>k&&c.find(o=>o.id===k)?.name||"",[c,k]),j=n.useMemo(()=>{if(t.whatsappEnabled===!1)return null;const s="Здравствуйте! Хочу записаться в A.K.beauty.",o=N?`${s} Процедура: "${N}".`:s;return ne({whatsappPhone:t.whatsappPhone,text:o})},[t.whatsappEnabled,t.whatsappPhone,N]),p=n.useMemo(()=>oe({telegramLink:t.socialMedia.telegram}),[t.socialMedia.telegram]),A=n.useMemo(()=>M(t.socialMedia.instagram),[t.socialMedia.instagram]),L=n.useMemo(()=>M(t.socialMedia.vk),[t.socialMedia.vk]),X=n.useMemo(()=>M(t.socialMedia.whatsapp),[t.socialMedia.whatsapp]),J=n.useCallback(async s=>{const o=T.current?.value;if(o&&o.trim().length>0){a(u("Похоже, сработала защита от спама. Обновите страницу и попробуйте снова."));return}const l=Date.now(),f=localStorage.getItem("booking_last_submit_ts"),_=f?Number(f):0;if(_&&l-_<6e4){a(u("Пожалуйста, подождите минуту и попробуйте снова."));return}a(le());try{const m=je(s.phone);if(!m){a(u("Укажите телефон в формате +7 (XXX) XXX-XX-XX"));return}const g=String(s.procedureId??"").trim();if(!g){a(u("Выберите процедуру."));return}const b=c.find(Z=>Z.id===g);if(!b){a(u("Выбранная процедура не найдена. Обновите страницу и попробуйте снова."));return}const H=(s.email??"").trim(),Y={...s,procedureId:g,phone:m,email:H||void 0},R=await fe({...Y,procedureName:b.name});R.success?(localStorage.setItem("booking_last_submit_ts",String(l)),a(ce())):a(u(R.message||"Ошибка отправки"))}catch(m){a(u(m instanceof Error?m.message:"Произошла ошибка"))}},[a,c]),F=t.mapEmbedUrl||"",Q=xe(U&&c.length===0,160);return e.jsxs(e.Fragment,{children:[e.jsx(ke,{title:"Контакты и запись",description:"Свяжитесь с нами или запишитесь на консультацию. Телефон, адрес, форма записи на сеанс.",keywords:"контакты косметолог, запись на процедуру, косметология контакты"}),e.jsx("div",{className:r.contacts,children:e.jsxs("div",{className:r.container,children:[e.jsx("h1",{className:r.title,children:"Контакты и запись"}),e.jsxs("div",{className:r.content,children:[e.jsx("div",{className:r.infoSection,children:e.jsx(W,{children:e.jsxs(z,{className:r.infoCard,children:[e.jsx("h2",{children:"Контактная информация"}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Телефон:"}),e.jsx("a",{href:`tel:${t.phone}`,children:t.phone})]}),j&&e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"WhatsApp:"}),e.jsx("a",{href:j,target:"_blank",rel:"noopener noreferrer",children:"Написать в WhatsApp"})]}),p&&e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Telegram:"}),e.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",children:"Написать в Telegram"})]}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Email:"}),e.jsx("a",{href:`mailto:${t.email}`,children:t.email})]}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Адрес:"}),e.jsx("p",{children:t.address})]}),e.jsxs("div",{className:r.contactItem,children:[e.jsx("strong",{children:"Часы работы:"}),e.jsx("p",{children:t.workingHours})]}),e.jsxs("div",{className:r.social,children:[e.jsx("h3",{children:"Социальные сети"}),e.jsxs("div",{className:r.socialLinks,children:[A&&e.jsx("a",{href:A,target:"_blank",rel:"noopener noreferrer",children:"Instagram"}),L&&e.jsx("a",{href:L,target:"_blank",rel:"noopener noreferrer",children:"VK"}),p&&e.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",children:"Telegram"}),X&&e.jsx("a",{href:X,target:"_blank",rel:"noopener noreferrer",children:"WhatsApp"})]})]}),e.jsx("div",{className:r.map,children:F?e.jsx("iframe",{title:"Карта",src:F,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",style:{width:"100%",height:320,border:0,borderRadius:12}}):e.jsxs("div",{className:r.mapPlaceholder,children:[e.jsx("p",{children:"Карта местоположения"}),e.jsx("p",{className:r.mapNote,children:"Укажите VITE_MAP_EMBED_URL в .env.local (или заполните ссылку в админке → Контакты), чтобы встроить карту"})]})})]})})}),e.jsx("div",{className:r.formSection,children:e.jsx(W,{delayMs:60,children:e.jsxs(z,{className:r.formCard,children:[e.jsx("h2",{children:"Записаться на сеанс"}),v&&e.jsxs("div",{className:r.successMessage,children:["✓ Ваша заявка успешно отправлена! Мы свяжемся с вами в ближайшее время.",j&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:j,target:"_blank",rel:"noopener noreferrer",children:e.jsx(S,{variant:"outline",size:"small",children:"Написать в WhatsApp сейчас"})})}),p&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",children:e.jsx(S,{variant:"outline",size:"small",children:"Написать в Telegram сейчас"})})})]}),C&&e.jsxs("div",{className:r.errorMessage,children:["✗ ",C]}),e.jsxs("form",{onSubmit:K(J),className:r.form,children:[e.jsx("input",{ref:T,id:D,name:D,type:"text",tabIndex:-1,autoComplete:"off",style:{position:"absolute",left:"-10000px",top:"auto"},"aria-hidden":"true"}),e.jsx(x,{label:"Имя",...d("name",{required:"Имя обязательно для заполнения",minLength:{value:2,message:"Имя должно содержать минимум 2 символа"}}),error:i.name?.message}),e.jsx(x,{label:"Телефон",type:"tel",inputMode:"tel",autoComplete:"tel",placeholder:"+7 (999) 462-10-36",...d("phone",{required:"Телефон обязателен для заполнения",validate:s=>_e(s)||"Неверный формат телефона"}),onFocus:s=>{s.target.value||h("phone",y(""),{shouldDirty:!1})},onChange:s=>{const o=y(s.target.value);h("phone",o,{shouldValidate:!0,shouldDirty:!0})},onKeyDown:s=>{if(s.key!=="Backspace")return;const o=s.currentTarget,l=o.value||"",f=o.selectionStart??l.length,_=o.selectionEnd??l.length;if(f!==_||f!==l.length)return;const m=l[l.length-1]||"";if(![")","-"," "].includes(m))return;const g=l.replace(/\D/g,"");if(g.length<=1){s.preventDefault(),h("phone",y(""),{shouldValidate:!0,shouldDirty:!0});return}const b=g.slice(0,-1);s.preventDefault(),h("phone",y(b),{shouldValidate:!0,shouldDirty:!0})},error:i.phone?.message}),e.jsx(x,{label:"Email (необязательно)",type:"email",inputMode:"email",autoComplete:"email",placeholder:"name@example.com",...d("email",{validate:s=>!s||be(s)||"Неверный формат email"}),error:i.email?.message}),e.jsx(he,{name:"procedureId",control:P,rules:{required:"Выберите процедуру"},render:({field:s})=>Q?e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("label",{style:{fontWeight:600,fontSize:14},children:"Процедура"}),e.jsx(ie,{height:56,radius:12})]}):e.jsx(ve,{label:"Процедура",options:G,...s,error:i.procedureId?.message})}),e.jsx(x,{label:"Желаемая дата",type:"date",...d("desiredDate",{required:"Укажите желаемую дату"}),error:i.desiredDate?.message}),e.jsx(x,{label:"Желаемое время",type:"time",...d("desiredTime",{required:"Укажите желаемое время"}),error:i.desiredTime?.message}),e.jsx(ye,{label:"Комментарий",...d("comment",{maxLength:{value:2e3,message:"Комментарий не должен превышать 2000 символов"}}),error:i.comment?.message}),e.jsxs("div",{className:r.checkbox,children:[e.jsx("input",{type:"checkbox",id:"consent",...d("consent",{required:"Необходимо согласие на обработку персональных данных"})}),e.jsxs("label",{htmlFor:"consent",children:["Я согласен(а) на обработку персональных данных."," ",e.jsx("a",{href:"/alla/privacy",target:"_blank",rel:"noopener noreferrer",children:"Политика конфиденциальности"})]}),i.consent&&e.jsx("span",{className:r.errorMessage,children:i.consent.message})]}),e.jsx(S,{type:"submit",size:"large",disabled:w,className:r.submitButton,children:w?"Отправка...":"Отправить заявку"})]})]})})})]})]})})]})};export{Ye as default};
