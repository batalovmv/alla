import{j as e,B as y,h as x,a0 as C,K as V}from"./index-CQRSAtSo.js";import{r as o}from"./react-vendor-BQWX9zlF.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-mpaoXh-M.js";import"./form-vendor-BjD3cHyu.js";const B="_calendar_6ued1_1",F="_header_6ued1_5",z="_title_6ued1_14",K="_subtitle_6ued1_19",O="_controls_6ued1_25",E="_control_6ued1_25",Y="_monthInput_6ued1_40",G="_weekdayRow_6ued1_48",A="_weekday_6ued1_48",U="_grid_6ued1_61",q="_dayCell_6ued1_67",H="_dayCellMuted_6ued1_76",J="_dayTop_6ued1_80",P="_dayNumber_6ued1_87",Q="_badge_6ued1_92",W="_preview_6ued1_106",X="_empty_6ued1_114",Z="_list_6ued1_119",ee="_bookingItem_6ued1_124",te="_bookingLine_6ued1_129",se="_bookingMain_6ued1_136",ae="_bookingTitle_6ued1_140",ne="_bookingSub_6ued1_147",ie="_timeChip_6ued1_156",le="_detailGrid_6ued1_166",oe="_detailRow_6ued1_171",de="_detailLabel_6ued1_179",ce="_detailValue_6ued1_184",re="_actions_6ued1_189",t={calendar:B,header:F,title:z,subtitle:K,controls:O,control:E,monthInput:Y,weekdayRow:G,weekday:A,grid:U,dayCell:q,dayCellMuted:H,dayTop:J,dayNumber:P,badge:Q,preview:W,empty:X,list:Z,bookingItem:ee,bookingLine:te,bookingMain:se,bookingTitle:ae,bookingSub:ne,timeChip:ie,detailGrid:le,detailRow:oe,detailLabel:de,detailValue:ce,actions:re};function me(a){const m=a.getFullYear(),u=String(a.getMonth()+1).padStart(2,"0");return`${m}-${u}`}function ue(a){const[m,u]=a.split("-").map(p=>Number(p));return new Date(m,(u||1)-1,1)}function he(a){return new Date(a.getFullYear(),a.getMonth(),1,0,0,0,0)}function _e(a){return new Date(a.getFullYear(),a.getMonth()+1,0,23,59,59,999)}function N(a){return a.toISOString().split("T")[0]}function ge(a){const m=new Date(a);return Number.isFinite(m.getTime())?m:new Date}function pe(a){return a==="processed"?"awaiting":String(a||"")}const xe=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],be=()=>{const[a,m]=o.useState(()=>me(new Date)),[u,p]=o.useState(!0),[w,v]=o.useState([]),[L,R]=o.useState(0),[h,b]=o.useState(null),[i,k]=o.useState(null);o.useEffect(()=>{let s=!0;return(async()=>{try{p(!0);const d=(await V.getAll()||[]).map(r=>({...r,_normalizedStatus:pe(r.status)})).filter(r=>r._normalizedStatus==="awaiting");s&&v(d)}catch(n){console.error("Ошибка загрузки календаря:",n),s&&v([])}finally{s&&p(!1)}})(),()=>{s=!1}},[a,L]);const _=o.useMemo(()=>ue(a),[a]),g=o.useMemo(()=>he(_),[_]),f=o.useMemo(()=>_e(_),[_]),j=o.useMemo(()=>{const s=new Map;for(const c of w){const n=ge(String(c.desiredDate||""));if(n<g||n>f)continue;const l=N(new Date(n.getFullYear(),n.getMonth(),n.getDate())),d=s.get(l)||[];d.push(c),s.set(l,d)}for(const[c,n]of s.entries())n.sort((l,d)=>String(l.desiredTime||"").localeCompare(String(d.desiredTime||""))),s.set(c,n);return s},[w,g,f]),T=o.useMemo(()=>{const c=new Date(g).getDay(),n=c===0?6:c-1,l=new Date(g);l.setDate(l.getDate()-n);const d=[];for(let r=0;r<42;r+=1){const S=new Date(l);S.setDate(l.getDate()+r),d.push(S)}return d},[g]),D=o.useMemo(()=>h?j.get(h)||[]:[],[j,h]),$=o.useMemo(()=>N(new Date),[]),I=()=>b(null),M=()=>k(null);return e.jsxs("div",{className:t.calendar,children:[e.jsxs("div",{className:t.header,children:[e.jsxs("div",{children:[e.jsx("h1",{className:t.title,children:"Календарь записей"}),e.jsx("p",{className:t.subtitle,children:"Здесь показываются подтверждённые заявки (статус: «Записаны»)."})]}),e.jsxs("div",{className:t.controls,children:[e.jsxs("label",{className:t.control,children:[e.jsx("span",{children:"Месяц"}),e.jsx("input",{type:"month",value:a,onChange:s=>m(s.target.value),className:t.monthInput})]}),e.jsx(y,{variant:"outline",onClick:()=>R(s=>s+1),disabled:u,children:"Обновить"})]})]}),u?e.jsx(x,{className:t.empty,children:"Загрузка…"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:t.weekdayRow,children:xe.map(s=>e.jsx("div",{className:t.weekday,children:s},s))}),e.jsx("div",{className:t.grid,children:T.map(s=>{const c=s.getMonth()===_.getMonth(),n=N(new Date(s.getFullYear(),s.getMonth(),s.getDate())),l=j.get(n)||[],d=l.length,r=l[0]?`${l[0].desiredTime||""} • ${l[0].name} • ${l[0].procedureName||""}`.trim():"";return e.jsxs(x,{className:`${t.dayCell} ${c?"":t.dayCellMuted}`,onClick:()=>b(n),children:[e.jsxs("div",{className:t.dayTop,children:[e.jsxs("div",{className:t.dayNumber,children:[s.getDate(),n===$?" •":""]}),d>0&&e.jsx("div",{className:t.badge,children:d})]}),d>0&&e.jsx("div",{className:t.preview,children:r})]},`${n}-${c?"m":"o"}`)})})]}),e.jsx(C,{isOpen:!!h,onClose:I,title:h?`Записи на ${new Date(h).toLocaleDateString("ru-RU")}`:void 0,children:D.length===0?e.jsx(x,{className:t.empty,children:"На этот день подтверждённых записей нет."}):e.jsx("div",{className:t.list,children:D.map(s=>e.jsx(x,{className:t.bookingItem,onClick:()=>k(s),children:e.jsxs("div",{className:t.bookingLine,children:[e.jsxs("div",{className:t.bookingMain,children:[e.jsx("p",{className:t.bookingTitle,children:s.name}),e.jsxs("p",{className:t.bookingSub,children:[s.procedureName||"Процедура"," • ",s.phone]})]}),e.jsx("div",{className:t.timeChip,children:s.desiredTime||"—"})]})},s.id))})}),e.jsx(C,{isOpen:!!i,onClose:M,title:i?`Заявка • ${i.name}`:void 0,children:i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:t.detailGrid,children:[e.jsxs("div",{className:t.detailRow,children:[e.jsx("div",{className:t.detailLabel,children:"Процедура"}),e.jsx("div",{className:t.detailValue,children:i.procedureName||"—"})]}),e.jsxs("div",{className:t.detailRow,children:[e.jsx("div",{className:t.detailLabel,children:"Дата/время"}),e.jsxs("div",{className:t.detailValue,children:[new Date(i.desiredDate).toLocaleDateString("ru-RU")," • ",i.desiredTime||"—"]})]}),e.jsxs("div",{className:t.detailRow,children:[e.jsx("div",{className:t.detailLabel,children:"Телефон"}),e.jsx("div",{className:t.detailValue,children:e.jsx("a",{href:`tel:${i.phone}`,children:i.phone})})]}),i.email&&e.jsxs("div",{className:t.detailRow,children:[e.jsx("div",{className:t.detailLabel,children:"Email"}),e.jsx("div",{className:t.detailValue,children:e.jsx("a",{href:`mailto:${i.email}`,children:i.email})})]}),i.comment&&e.jsxs("div",{className:t.detailRow,children:[e.jsx("div",{className:t.detailLabel,children:"Комментарий"}),e.jsx("div",{className:t.detailValue,children:i.comment})]}),e.jsxs("div",{className:t.detailRow,children:[e.jsx("div",{className:t.detailLabel,children:"Создано"}),e.jsx("div",{className:t.detailValue,children:i.createdAt?new Date(i.createdAt).toLocaleString("ru-RU"):"—"})]})]}),e.jsxs("div",{className:t.actions,children:[e.jsx(y,{size:"small",onClick:()=>{window.open(`tel:${i.phone}`,"_self")},children:"Позвонить"}),e.jsx(y,{size:"small",variant:"secondary",onClick:()=>M(),children:"Закрыть"})]})]})})]})};export{be as default};
