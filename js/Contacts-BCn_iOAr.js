import{u as ue,a as K,C as he,s as G,b as pe,r as ge,q as J,t as Q,v as Y,w as D,x as Z,g as fe,e as xe,f as je,y as q,z as j,A as _e,D as be,j as e,h as ee,B as C,I as v,S as Me,E as se}from"./index-B6HG0ZK_.js";import{f as ke,r as a}from"./react-vendor-BQWX9zlF.js";import{u as ye,a as E,C as re}from"./form-vendor-BjD3cHyu.js";import{f as we,i as ve,c as Ne,b as Se}from"./useInView-100OXk2y.js";import{n as Te,v as Ie,M as De,a as qe}from"./MaskedPhoneInput-Ctv1vois.js";import{T as Ce}from"./Textarea-BSvR96Lh.js";import{S as Ee}from"./Select-B1b_cuX9.js";import{S as He}from"./SEO-8NiqfZiD.js";import{R as te}from"./Reveal-CGSqfhn1.js";import{f as Pe}from"./money-Dqo8ClJ3.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-mpaoXh-M.js";const Be="_contacts_1nygq_1",Fe="_container_1nygq_6",Ae="_title_1nygq_11",Le="_content_1nygq_19",We="_infoCard_1nygq_25",$e="_formCard_1nygq_26",Xe="_contactItem_1nygq_37",ze="_social_1nygq_63",Re="_socialLinks_1nygq_75",Ve="_map_1nygq_91",Ue="_mapPlaceholder_1nygq_97",Oe="_mapNote_1nygq_109",Ke="_form_1nygq_26",Ge="_checkbox_1nygq_120",Je="_successMessage_1nygq_138",Qe="_errorMessage_1nygq_147",Ye="_submitButton_1nygq_153",n={contacts:Be,container:Fe,title:Ae,content:Le,infoCard:We,formCard:$e,contactItem:Xe,social:ze,socialLinks:Re,map:Ve,mapPlaceholder:Ue,mapNote:Oe,form:Ke,checkbox:Ge,successMessage:Je,errorMessage:Qe,submitButton:Ye},ms=()=>{const i=ue(),[H]=ke(),{items:l,lastFetched:P,loading:ne}=K(s=>s.procedures),{isSubmitting:B,success:N,error:F}=K(s=>s.booking),[r,ae]=a.useState({...he,mapEmbedUrl:"",whatsappPhone:""}),{register:_,handleSubmit:oe,formState:{errors:h},reset:A,setValue:f,control:k}=ye({defaultValues:{consent:!1}}),S=E({control:k,name:"procedureId"}),m=E({control:k,name:"desiredDate"}),x=E({control:k,name:"desiredTime"}),L=a.useRef(null),W=a.useMemo(()=>`hp_${Math.random().toString(36).slice(2)}`,[]),$=a.useCallback(async()=>{i(G(!0));try{const s=await we();i(pe(s))}finally{i(G(!1))}},[i]);a.useEffect(()=>{(l.length===0||ve(P,3e5))&&$()},[l.length,P,$]),a.useEffect(()=>{const s=H.get("procedureId");if(s&&l.length>0&&l.some(o=>o.id===s)){const o=setTimeout(()=>{f("procedureId",s,{shouldValidate:!0,shouldDirty:!0})},0);return()=>clearTimeout(o)}},[H,l,f]),a.useEffect(()=>{if(N){A();const s=setTimeout(()=>{i(ge())},5e3);return()=>clearTimeout(s)}},[N,A,i]),a.useEffect(()=>{const s=!!m,t=!!x;if(s&&t)return;const{suggestedDate:o,suggestedTime:d}=J({workingHours:r.workingHours,schedule:r.workingSchedule,leadMinutes:90,stepMinutes:15});s||f("desiredDate",o,{shouldDirty:!1}),t||f("desiredTime",d,{shouldDirty:!1})},[r.workingHours]);const X=a.useMemo(()=>J({workingHours:r.workingHours,schedule:r.workingSchedule,leadMinutes:90,stepMinutes:15}).notice||"",[r.workingHours]),p=a.useMemo(()=>{if(!m)return null;const s=new Date(`${m}T00:00:00`),t=r.workingSchedule?Q(r.workingSchedule,s):Y(r.workingHours,s);if(!t)return null;const o=new Date,d=D(o)===m,u=o.getHours()*60+o.getMinutes(),c=d?Math.max(t.openMin,u+30):t.openMin,g=Math.max(t.openMin,t.closeMin-60),M=Z(se(c,15)),w=Z(se(g,15));return{min:M,max:w}},[r.workingHours,m]);a.useEffect(()=>{if(!m||!p)return;if(!x){f("desiredTime",p.max,{shouldDirty:!1});return}const s=u=>{const[c,g]=u.split(":").map(Number);return!Number.isFinite(c)||!Number.isFinite(g)?null:c*60+g},t=s(x),o=s(p.min),d=s(p.max);t==null||o==null||d==null||(t<o&&f("desiredTime",p.min,{shouldValidate:!0,shouldDirty:!0}),t>d&&f("desiredTime",p.max,{shouldValidate:!0,shouldDirty:!0}))},[m,x,p,f]);const T=a.useMemo(()=>{if(!m||!x)return"";const s=new Date(`${m}T00:00:00`),t=r.workingSchedule?Q(r.workingSchedule,s):Y(r.workingHours,s);if(!t)return"Для выбранной даты часы работы не указаны. Пожалуйста, выберите другое время.";const[o,d]=x.split(":").map(Number);if(!Number.isFinite(o)||!Number.isFinite(d))return"Укажите корректное время.";const u=o*60+d;if(u<t.openMin||u>=t.closeMin)return"Мы не работаем в это время — выберите другое.";const c=new Date;if(D(c)===m){const M=c.getHours()*60+c.getMinutes();if(u<M+30)return"Пожалуйста, выберите время чуть позже (минимум через 30 минут)."}return""},[r.workingHours,m,x]);a.useEffect(()=>{let s=!0;return fe().then(t=>{s&&ae(t)}).catch(()=>{}),()=>{s=!1}},[]);const ie=a.useMemo(()=>l.map(s=>({value:s.id,label:`${s.name} - ${Pe(s.price)}`})),[l]),I=a.useMemo(()=>S&&l.find(t=>t.id===S)?.name||"",[l,S]),y=a.useMemo(()=>{if(r.whatsappEnabled===!1)return null;const s="Здравствуйте! Хочу записаться в A.K.beauty.",t=I?`${s} Процедура: "${I}".`:s;return xe({whatsappPhone:r.whatsappPhone,text:t})},[r.whatsappEnabled,r.whatsappPhone,I]),b=a.useMemo(()=>je({telegramLink:r.socialMedia.telegram}),[r.socialMedia.telegram]),z=a.useMemo(()=>q(r.socialMedia.instagram),[r.socialMedia.instagram]),R=a.useMemo(()=>q(r.socialMedia.vk),[r.socialMedia.vk]),V=a.useMemo(()=>q(r.socialMedia.whatsapp),[r.socialMedia.whatsapp]),ce=a.useCallback(async s=>{const t=L.current?.value;if(t&&t.trim().length>0){i(j("Похоже, сработала защита от спама. Обновите страницу и попробуйте снова."));return}const o=Date.now(),d=localStorage.getItem("booking_last_submit_ts"),u=d?Number(d):0;if(u&&o-u<6e4){i(j("Пожалуйста, подождите минуту и попробуйте снова."));return}i(_e());try{const c=Te(s.phone);if(!c){i(j("Укажите телефон в формате +7 (XXX) XXX-XX-XX"));return}const g=String(s.procedureId??"").trim();if(!g){i(j("Выберите процедуру."));return}const M=l.find(me=>me.id===g);if(!M){i(j("Выбранная процедура не найдена. Обновите страницу и попробуйте снова."));return}const w=(s.email??"").trim(),de={...s,procedureId:g,phone:c,email:w||void 0},O=await Ne({...de,procedureName:M.name});O.success?(localStorage.setItem("booking_last_submit_ts",String(o)),i(be())):i(j(O.message||"Ошибка отправки"))}catch(c){i(j(c instanceof Error?c.message:"Произошла ошибка"))}},[i,l]),U=r.mapEmbedUrl||"",le=Se(ne&&l.length===0,160);return e.jsxs(e.Fragment,{children:[e.jsx(He,{title:"Контакты и запись",description:"Свяжитесь с нами или запишитесь на консультацию. Телефон, адрес, форма записи на сеанс.",keywords:"контакты косметолог, запись на процедуру, косметология контакты"}),e.jsx("div",{className:n.contacts,children:e.jsxs("div",{className:n.container,children:[e.jsx("h1",{className:n.title,children:"Контакты и запись"}),e.jsxs("div",{className:n.content,children:[e.jsx("div",{className:n.infoSection,children:e.jsx(te,{children:e.jsxs(ee,{className:n.infoCard,children:[e.jsx("h2",{children:"Контактная информация"}),e.jsxs("div",{className:n.contactItem,children:[e.jsx("strong",{children:"Телефон:"}),e.jsx("a",{href:`tel:${r.phone}`,children:r.phone})]}),y&&e.jsxs("div",{className:n.contactItem,children:[e.jsx("strong",{children:"WhatsApp:"}),e.jsx("a",{href:y,target:"_blank",rel:"noopener noreferrer",children:"Написать в WhatsApp"})]}),b&&e.jsxs("div",{className:n.contactItem,children:[e.jsx("strong",{children:"Telegram:"}),e.jsx("a",{href:b,target:"_blank",rel:"noopener noreferrer",children:"Написать в Telegram"})]}),e.jsxs("div",{className:n.contactItem,children:[e.jsx("strong",{children:"Email:"}),e.jsx("a",{href:`mailto:${r.email}`,children:r.email})]}),e.jsxs("div",{className:n.contactItem,children:[e.jsx("strong",{children:"Адрес:"}),e.jsx("p",{children:r.address})]}),e.jsxs("div",{className:n.contactItem,children:[e.jsx("strong",{children:"Часы работы:"}),e.jsx("p",{children:r.workingHours})]}),e.jsxs("div",{className:n.social,children:[e.jsx("h3",{children:"Социальные сети"}),e.jsxs("div",{className:n.socialLinks,children:[z&&e.jsx("a",{href:z,target:"_blank",rel:"noopener noreferrer",children:"Instagram"}),R&&e.jsx("a",{href:R,target:"_blank",rel:"noopener noreferrer",children:"VK"}),b&&e.jsx("a",{href:b,target:"_blank",rel:"noopener noreferrer",children:"Telegram"}),V&&e.jsx("a",{href:V,target:"_blank",rel:"noopener noreferrer",children:"WhatsApp"})]})]}),e.jsx("div",{className:n.map,children:U?e.jsx("iframe",{title:"Карта",src:U,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",style:{width:"100%",height:320,border:0,borderRadius:12}}):e.jsxs("div",{className:n.mapPlaceholder,children:[e.jsx("p",{children:"Карта местоположения"}),e.jsx("p",{className:n.mapNote,children:"Укажите VITE_MAP_EMBED_URL в .env.local (или заполните ссылку в админке → Контакты), чтобы встроить карту"})]})})]})})}),e.jsx("div",{className:n.formSection,children:e.jsx(te,{delayMs:60,children:e.jsxs(ee,{className:n.formCard,children:[e.jsx("h2",{children:"Записаться на сеанс"}),N&&e.jsxs("div",{className:n.successMessage,children:["✓ Ваша заявка успешно отправлена! Мы свяжемся с вами в ближайшее время.",y&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:y,target:"_blank",rel:"noopener noreferrer",children:e.jsx(C,{variant:"outline",size:"small",children:"Написать в WhatsApp сейчас"})})}),b&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:b,target:"_blank",rel:"noopener noreferrer",children:e.jsx(C,{variant:"outline",size:"small",children:"Написать в Telegram сейчас"})})})]}),F&&e.jsxs("div",{className:n.errorMessage,children:["✗ ",F]}),e.jsxs("form",{onSubmit:oe(ce),className:n.form,children:[e.jsx("input",{ref:L,id:W,name:W,type:"text",tabIndex:-1,autoComplete:"off",style:{position:"absolute",left:"-10000px",top:"auto"},"aria-hidden":"true"}),e.jsx(v,{label:"Имя",..._("name",{required:"Имя обязательно для заполнения",minLength:{value:2,message:"Имя должно содержать минимум 2 символа"}}),error:h.name?.message}),e.jsx(re,{name:"phone",control:k,rules:{required:"Телефон обязателен для заполнения",validate:s=>Ie(String(s||""))||"Неверный формат телефона"},render:({field:s})=>e.jsx(De,{label:"Телефон",inputMode:"tel",autoComplete:"tel",value:String(s.value||""),onChange:t=>s.onChange(t),onBlur:s.onBlur,required:!0,error:h.phone?.message})}),e.jsx(v,{label:"Email (необязательно)",type:"email",inputMode:"email",autoComplete:"email",placeholder:"name@example.com",..._("email",{validate:s=>!s||qe(s)||"Неверный формат email"}),error:h.email?.message}),e.jsx(re,{name:"procedureId",control:k,rules:{required:"Выберите процедуру"},render:({field:s})=>le?e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("label",{style:{fontWeight:600,fontSize:14},children:"Процедура"}),e.jsx(Me,{height:56,radius:12})]}):e.jsx(Ee,{label:"Процедура",options:ie,...s,error:h.procedureId?.message})}),e.jsx(v,{label:"Желаемая дата",type:"date",..._("desiredDate",{required:"Укажите желаемую дату",validate:s=>{if(!s)return"Укажите желаемую дату";const t=D(new Date);return s<t?"Нельзя выбрать прошедшую дату":!0}}),error:h.desiredDate?.message}),e.jsx(v,{label:"Желаемое время",type:"time",step:900,min:p?.min,max:p?.max,..._("desiredTime",{required:"Укажите желаемое время",validate:()=>T||!0}),error:h.desiredTime?.message||T||X||void 0}),e.jsx(Ce,{label:"Комментарий",..._("comment",{maxLength:{value:2e3,message:"Комментарий не должен превышать 2000 символов"}}),error:h.comment?.message}),e.jsxs("div",{className:n.checkbox,children:[e.jsx("input",{type:"checkbox",id:"consent",..._("consent",{required:"Необходимо согласие на обработку персональных данных"})}),e.jsxs("label",{htmlFor:"consent",children:["Я согласен(а) на обработку персональных данных."," ",e.jsx("a",{href:"/alla/privacy",target:"_blank",rel:"noopener noreferrer",children:"Политика конфиденциальности"})]}),h.consent&&e.jsx("span",{className:n.errorMessage,children:h.consent.message})]}),e.jsx(C,{type:"submit",size:"large",disabled:B,className:n.submitButton,children:B?"Отправка...":"Отправить заявку"})]})]})})})]})]})})]})};export{ms as default};
