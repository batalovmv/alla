import{W as u,X as w,C as a,Y as x,j as s,p as E,Z as f,h as T,I as t,B as N}from"./index-B6HG0ZK_.js";import{r as n}from"./react-vendor-BQWX9zlF.js";import{u as P}from"./form-vendor-BjD3cHyu.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-mpaoXh-M.js";const W="_contacts_amv71_1",C="_title_amv71_5",H="_card_amv71_15",I="_successMessage_amv71_19",U="_form_amv71_28",q="_sectionTitle_amv71_34",$="_actions_amv71_40",o={contacts:W,title:C,card:H,successMessage:I,form:U,sectionTitle:q,actions:$},K=()=>{const[b,d]=n.useState(!0),[p,g]=n.useState(!1),[j,c]=n.useState(!1),{register:r,handleSubmit:k,formState:{errors:i},reset:h,watch:m}=P();n.useEffect(()=>{S()},[]);const S=async()=>{try{d(!0);const e=await u.get();if(e){const l=e.workingSchedule||w(e.workingHours||a.workingHours)||x();h({phone:e.phone||a.phone,whatsappPhone:e.whatsappPhone||"",email:e.email||a.email,address:e.address||a.address,workingSchedule:l,mapEmbedUrl:e.mapEmbedUrl||"",instagram:e.socialMedia?.instagram||a.socialMedia.instagram,vk:e.socialMedia?.vk||a.socialMedia.vk,telegram:e.socialMedia?.telegram||a.socialMedia.telegram,whatsapp:e.socialMedia?.whatsapp||a.socialMedia.whatsapp})}else h({phone:a.phone,whatsappPhone:"",email:a.email,address:a.address,workingSchedule:w(a.workingHours),mapEmbedUrl:"",instagram:a.socialMedia.instagram,vk:a.socialMedia.vk,telegram:a.socialMedia.telegram,whatsapp:a.socialMedia.whatsapp})}catch(e){console.error("Ошибка загрузки контактов:",e)}finally{d(!1)}},v=async e=>{g(!0),c(!1);try{const l=f(e.workingSchedule);await u.update({phone:e.phone,whatsappPhone:String(e.whatsappPhone||"").replace(/\D/g,""),email:e.email,address:e.address,workingHours:l,workingSchedule:e.workingSchedule,mapEmbedUrl:e.mapEmbedUrl||"",socialMedia:{instagram:e.instagram,vk:e.vk,telegram:e.telegram,whatsapp:e.whatsapp}}),c(!0),setTimeout(()=>c(!1),3e3)}catch(l){console.error("Ошибка сохранения контактов:",l),alert("Ошибка при сохранении контактов")}finally{g(!1)}};if(b)return s.jsx(E,{variant:"admin"});const _=m("workingSchedule")||x(),y=f(_),M=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];return s.jsxs("div",{className:o.contacts,children:[s.jsx("h1",{className:o.title,children:"Редактирование контактов"}),s.jsxs(T,{className:o.card,children:[j&&s.jsx("div",{className:o.successMessage,children:"✓ Контакты успешно сохранены"}),s.jsxs("form",{onSubmit:k(v),className:o.form,children:[s.jsx(t,{label:"Телефон",...r("phone",{required:"Телефон обязателен"}),error:i.phone?.message}),s.jsx(t,{label:"WhatsApp номер (для wa.me, формат 7700..., без + и пробелов)",...r("whatsappPhone",{validate:e=>{if(!e)return!0;const l=String(e).replace(/\D/g,"");return l.length!==11?"Введите номер из 11 цифр (например 77001234567)":l.startsWith("7")?!0:"Номер должен начинаться с 7"}}),error:i.whatsappPhone?.message}),s.jsx(t,{label:"Email",type:"email",...r("email",{required:"Email обязателен"}),error:i.email?.message}),s.jsx(t,{label:"Адрес",...r("address",{required:"Адрес обязателен"}),error:i.address?.message}),s.jsx("h3",{className:o.sectionTitle,children:"График работы"}),s.jsx("div",{style:{display:"grid",gap:10},children:M.map(e=>s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr 1fr 120px",gap:10,alignItems:"end"},children:[s.jsx("div",{style:{fontWeight:600,paddingBottom:8},children:e}),s.jsx(t,{label:"Открытие",type:"time",step:900,disabled:m(`workingSchedule.${e}.closed`),...r(`workingSchedule.${e}.open`,{required:!0})}),s.jsx(t,{label:"Закрытие",type:"time",step:900,disabled:m(`workingSchedule.${e}.closed`),...r(`workingSchedule.${e}.close`,{required:!0})}),s.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center",paddingBottom:8},children:[s.jsx("input",{type:"checkbox",...r(`workingSchedule.${e}.closed`)}),"Выходной"]})]},e))}),s.jsxs("div",{style:{marginTop:8,opacity:.85},children:[s.jsx("strong",{children:"Как будет показано на сайте:"})," ",y]}),s.jsx(t,{label:"Ссылка для встраивания карты (iframe src)",type:"url",...r("mapEmbedUrl"),error:i.mapEmbedUrl?.message}),s.jsx("h3",{className:o.sectionTitle,children:"Социальные сети"}),s.jsx(t,{label:"Instagram",type:"url",...r("instagram"),error:i.instagram?.message}),s.jsx(t,{label:"VK",type:"url",...r("vk"),error:i.vk?.message}),s.jsx(t,{label:"Telegram",type:"url",...r("telegram"),error:i.telegram?.message}),s.jsx(t,{label:"WhatsApp",type:"url",...r("whatsapp"),error:i.whatsapp?.message}),s.jsx("div",{className:o.actions,children:s.jsx(N,{type:"submit",disabled:p,children:p?"Сохранение...":"Сохранить"})})]})]})]})};export{K as default};
