import{u as J,a as F,C as Q,s as H,b as Y,r as Z,g as ee,e as se,f as te,q as M,t as V,v as _,w as re,j as e,h as $,B as I,I as f,S as ae}from"./index-8SBjvb2L.js";import{f as ne,r as o}from"./react-vendor-BQWX9zlF.js";import{u as oe,a as le,C as ce}from"./form-vendor-BjD3cHyu.js";import{f as ie,i as de,c as me,b as he}from"./useInView-Cc-Is9-s.js";import{n as ue,f as b,v as pe,a as ge}from"./validation-DcG8pJds.js";import{T as fe}from"./Textarea-DmRgz8u5.js";import{S as xe}from"./Select-23fnXync.js";import{S as je}from"./SEO-CasmsvBy.js";import{R as z}from"./Reveal-DHdPN738.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-CGxEfUHl.js";const _e="_contacts_1nygq_1",be="_container_1nygq_6",ye="_title_1nygq_11",ve="_content_1nygq_19",ke="_infoCard_1nygq_25",Ne="_formCard_1nygq_26",Me="_contactItem_1nygq_37",Ie="_social_1nygq_63",Se="_socialLinks_1nygq_75",qe="_map_1nygq_91",we="_mapPlaceholder_1nygq_97",Ce="_mapNote_1nygq_109",Ee="_form_1nygq_26",Pe="_checkbox_1nygq_120",Te="_successMessage_1nygq_138",De="_errorMessage_1nygq_147",Be="_submitButton_1nygq_153",t={contacts:_e,container:be,title:ye,content:ve,infoCard:ke,formCard:Ne,contactItem:Me,social:Ie,socialLinks:Se,map:qe,mapPlaceholder:we,mapNote:Ce,form:Ee,checkbox:Pe,successMessage:Te,errorMessage:De,submitButton:Be},Oe=()=>{const n=J(),[S]=ne(),{items:c,lastFetched:q,loading:R}=F(s=>s.procedures),{isSubmitting:w,success:y,error:C}=F(s=>s.booking),[r,W]=o.useState({...Q,mapEmbedUrl:"",whatsappPhone:""}),{register:d,handleSubmit:U,formState:{errors:i},reset:E,setValue:h,control:P}=oe({defaultValues:{consent:!1}}),v=le({control:P,name:"procedureId"}),T=o.useCallback(async()=>{n(H(!0));try{const s=await ie();n(Y(s))}finally{n(H(!1))}},[n]);o.useEffect(()=>{(c.length===0||de(q,3e5))&&T()},[c.length,q,T]),o.useEffect(()=>{const s=S.get("procedureId");if(s&&c.length>0&&c.some(l=>l.id===s)){const l=setTimeout(()=>{h("procedureId",s,{shouldValidate:!0,shouldDirty:!0})},0);return()=>clearTimeout(l)}},[S,c,h]),o.useEffect(()=>{if(y){E();const s=setTimeout(()=>{n(Z())},5e3);return()=>clearTimeout(s)}},[y,E,n]),o.useEffect(()=>{let s=!0;return ee().then(a=>{s&&W(a)}).catch(()=>{}),()=>{s=!1}},[]);const O=o.useMemo(()=>c.map(s=>({value:s.id,label:`${s.name} - ${s.price} ₽`})),[c]),k=o.useMemo(()=>v&&c.find(a=>a.id===v)?.name||"",[c,v]),x=o.useMemo(()=>{if(r.whatsappEnabled===!1)return null;const s="Здравствуйте! Хочу записаться в A.K.beauty.",a=k?`${s} Процедура: "${k}".`:s;return se({whatsappPhone:r.whatsappPhone,text:a})},[r.whatsappEnabled,r.whatsappPhone,k]),u=o.useMemo(()=>te({telegramLink:r.socialMedia.telegram}),[r.socialMedia.telegram]),D=o.useMemo(()=>M(r.socialMedia.instagram),[r.socialMedia.instagram]),B=o.useMemo(()=>M(r.socialMedia.vk),[r.socialMedia.vk]),A=o.useMemo(()=>M(r.socialMedia.whatsapp),[r.socialMedia.whatsapp]),K=o.useCallback(async s=>{const a=document.getElementById("hp_company")?.value;if(a&&a.trim().length>0){n(V());return}const l=Date.now(),p=localStorage.getItem("booking_last_submit_ts"),j=p?Number(p):0;if(j&&l-j<6e4){n(_("Пожалуйста, подождите минуту и попробуйте снова."));return}n(re());try{const m=ue(s.phone);if(!m){n(_("Укажите телефон в формате +7 (XXX) XXX-XX-XX"));return}const g=(s.email??"").trim(),N={...s,phone:m,email:g||void 0},X=await me(N);X.success?(localStorage.setItem("booking_last_submit_ts",String(l)),n(V())):n(_(X.message||"Ошибка отправки"))}catch(m){n(_(m instanceof Error?m.message:"Произошла ошибка"))}},[n]),L=r.mapEmbedUrl||"",G=he(R&&c.length===0,160);return e.jsxs(e.Fragment,{children:[e.jsx(je,{title:"Контакты и запись",description:"Свяжитесь с нами или запишитесь на консультацию. Телефон, адрес, форма записи на сеанс.",keywords:"контакты косметолог, запись на процедуру, косметология контакты"}),e.jsx("div",{className:t.contacts,children:e.jsxs("div",{className:t.container,children:[e.jsx("h1",{className:t.title,children:"Контакты и запись"}),e.jsxs("div",{className:t.content,children:[e.jsx("div",{className:t.infoSection,children:e.jsx(z,{children:e.jsxs($,{className:t.infoCard,children:[e.jsx("h2",{children:"Контактная информация"}),e.jsxs("div",{className:t.contactItem,children:[e.jsx("strong",{children:"Телефон:"}),e.jsx("a",{href:`tel:${r.phone}`,children:r.phone})]}),x&&e.jsxs("div",{className:t.contactItem,children:[e.jsx("strong",{children:"WhatsApp:"}),e.jsx("a",{href:x,target:"_blank",rel:"noopener noreferrer",children:"Написать в WhatsApp"})]}),u&&e.jsxs("div",{className:t.contactItem,children:[e.jsx("strong",{children:"Telegram:"}),e.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",children:"Написать в Telegram"})]}),e.jsxs("div",{className:t.contactItem,children:[e.jsx("strong",{children:"Email:"}),e.jsx("a",{href:`mailto:${r.email}`,children:r.email})]}),e.jsxs("div",{className:t.contactItem,children:[e.jsx("strong",{children:"Адрес:"}),e.jsx("p",{children:r.address})]}),e.jsxs("div",{className:t.contactItem,children:[e.jsx("strong",{children:"Часы работы:"}),e.jsx("p",{children:r.workingHours})]}),e.jsxs("div",{className:t.social,children:[e.jsx("h3",{children:"Социальные сети"}),e.jsxs("div",{className:t.socialLinks,children:[D&&e.jsx("a",{href:D,target:"_blank",rel:"noopener noreferrer",children:"Instagram"}),B&&e.jsx("a",{href:B,target:"_blank",rel:"noopener noreferrer",children:"VK"}),u&&e.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",children:"Telegram"}),A&&e.jsx("a",{href:A,target:"_blank",rel:"noopener noreferrer",children:"WhatsApp"})]})]}),e.jsx("div",{className:t.map,children:L?e.jsx("iframe",{title:"Карта",src:L,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",style:{width:"100%",height:320,border:0,borderRadius:12}}):e.jsxs("div",{className:t.mapPlaceholder,children:[e.jsx("p",{children:"Карта местоположения"}),e.jsx("p",{className:t.mapNote,children:"Укажите VITE_MAP_EMBED_URL в .env.local (или заполните ссылку в админке → Контакты), чтобы встроить карту"})]})})]})})}),e.jsx("div",{className:t.formSection,children:e.jsx(z,{delayMs:60,children:e.jsxs($,{className:t.formCard,children:[e.jsx("h2",{children:"Записаться на сеанс"}),y&&e.jsxs("div",{className:t.successMessage,children:["✓ Ваша заявка успешно отправлена! Мы свяжемся с вами в ближайшее время.",x&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:x,target:"_blank",rel:"noopener noreferrer",children:e.jsx(I,{variant:"outline",size:"small",children:"Написать в WhatsApp сейчас"})})}),u&&e.jsx("div",{style:{marginTop:12},children:e.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",children:e.jsx(I,{variant:"outline",size:"small",children:"Написать в Telegram сейчас"})})})]}),C&&e.jsxs("div",{className:t.errorMessage,children:["✗ ",C]}),e.jsxs("form",{onSubmit:U(K),className:t.form,children:[e.jsx("input",{id:"hp_company",type:"text",tabIndex:-1,autoComplete:"off",style:{position:"absolute",left:"-10000px",top:"auto"},"aria-hidden":"true"}),e.jsx(f,{label:"Имя",...d("name",{required:"Имя обязательно для заполнения",minLength:{value:2,message:"Имя должно содержать минимум 2 символа"}}),error:i.name?.message}),e.jsx(f,{label:"Телефон",type:"tel",inputMode:"tel",autoComplete:"tel",placeholder:"+7 (999) 462-10-36",...d("phone",{required:"Телефон обязателен для заполнения",validate:s=>pe(s)||"Неверный формат телефона"}),onFocus:s=>{s.target.value||h("phone",b(""),{shouldDirty:!1})},onChange:s=>{const a=b(s.target.value);h("phone",a,{shouldValidate:!0,shouldDirty:!0})},onKeyDown:s=>{if(s.key!=="Backspace")return;const a=s.currentTarget,l=a.value||"",p=a.selectionStart??l.length,j=a.selectionEnd??l.length;if(p!==j||p!==l.length)return;const m=l[l.length-1]||"";if(![")","-"," "].includes(m))return;const g=l.replace(/\D/g,"");if(g.length<=1){s.preventDefault(),h("phone",b(""),{shouldValidate:!0,shouldDirty:!0});return}const N=g.slice(0,-1);s.preventDefault(),h("phone",b(N),{shouldValidate:!0,shouldDirty:!0})},error:i.phone?.message}),e.jsx(f,{label:"Email (необязательно)",type:"email",inputMode:"email",autoComplete:"email",placeholder:"name@example.com",...d("email",{validate:s=>!s||ge(s)||"Неверный формат email"}),error:i.email?.message}),e.jsx(ce,{name:"procedureId",control:P,rules:{required:"Выберите процедуру"},render:({field:s})=>G?e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("label",{style:{fontWeight:600,fontSize:14},children:"Процедура"}),e.jsx(ae,{height:56,radius:12})]}):e.jsx(xe,{label:"Процедура",options:O,...s,error:i.procedureId?.message})}),e.jsx(f,{label:"Желаемая дата",type:"date",...d("desiredDate",{required:"Укажите желаемую дату"}),error:i.desiredDate?.message}),e.jsx(f,{label:"Желаемое время",type:"time",...d("desiredTime",{required:"Укажите желаемое время"}),error:i.desiredTime?.message}),e.jsx(fe,{label:"Комментарий",...d("comment",{maxLength:{value:2e3,message:"Комментарий не должен превышать 2000 символов"}}),error:i.comment?.message}),e.jsxs("div",{className:t.checkbox,children:[e.jsx("input",{type:"checkbox",id:"consent",...d("consent",{required:"Необходимо согласие на обработку персональных данных"})}),e.jsxs("label",{htmlFor:"consent",children:["Я согласен(а) на обработку персональных данных."," ",e.jsx("a",{href:"/alla/privacy",target:"_blank",rel:"noopener noreferrer",children:"Политика конфиденциальности"})]}),i.consent&&e.jsx("span",{className:t.errorMessage,children:i.consent.message})]}),e.jsx(I,{type:"submit",size:"large",disabled:w,className:t.submitButton,children:w?"Отправка...":"Отправить заявку"})]})]})})})]})]})})]})};export{Oe as default};
