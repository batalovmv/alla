import{W as D,X as W,C as c,Y as $,j as s,p as V,Z as E,h as K,I as o,B as X}from"./index-TBdT1FO9.js";import{r as u}from"./react-vendor-BQWX9zlF.js";import{u as Y}from"./form-vendor-BjD3cHyu.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-mpaoXh-M.js";const Z="_contacts_1r39g_1",z="_title_1r39g_5",J="_card_1r39g_15",Q="_successMessage_1r39g_19",ee="_form_1r39g_28",se="_sectionTitle_1r39g_34",le="_actions_1r39g_40",ae="_scheduleModeRow_1r39g_45",oe="_scheduleModeLabel_1r39g_53",ce="_scheduleModeSelect_1r39g_59",re="_scheduleGrid_1r39g_67",te="_scheduleRowSimpleWeek_1r39g_72",ne="_scheduleRowSimpleDay_1r39g_79",de="_scheduleRowAdvanced_1r39g_86",ie="_dayLabel_1r39g_93",ue="_closedToggle_1r39g_98",he="_preview_1r39g_105",l={contacts:Z,title:z,card:J,successMessage:Q,form:ee,sectionTitle:se,actions:le,scheduleModeRow:ae,scheduleModeLabel:oe,scheduleModeSelect:ce,scheduleGrid:re,scheduleRowSimpleWeek:te,scheduleRowSimpleDay:ne,scheduleRowAdvanced:de,dayLabel:ie,closedToggle:ue,preview:he},ke=()=>{const[L,x]=u.useState(!0),[b,_]=u.useState(!1),[P,p]=u.useState(!1),[j,A]=u.useState(()=>localStorage.getItem("admin_schedule_mode")==="advanced"?"advanced":"simple"),{register:t,handleSubmit:H,formState:{errors:n},reset:f,watch:r,getValues:I,setValue:d}=Y();u.useEffect(()=>{U()},[]);const U=async()=>{try{x(!0);const e=await D.get();if(e){const a=e.workingSchedule||W(e.workingHours||c.workingHours)||$();f({phone:e.phone||c.phone,whatsappPhone:e.whatsappPhone||"",email:e.email||c.email,address:e.address||c.address,workingSchedule:a,mapEmbedUrl:e.mapEmbedUrl||"",instagram:e.socialMedia?.instagram||c.socialMedia.instagram,vk:e.socialMedia?.vk||c.socialMedia.vk,telegram:e.socialMedia?.telegram||c.socialMedia.telegram,whatsapp:e.socialMedia?.whatsapp||c.socialMedia.whatsapp})}else f({phone:c.phone,whatsappPhone:"",email:c.email,address:c.address,workingSchedule:W(c.workingHours),mapEmbedUrl:"",instagram:c.socialMedia.instagram,vk:c.socialMedia.vk,telegram:c.socialMedia.telegram,whatsapp:c.socialMedia.whatsapp})}catch(e){console.error("Ошибка загрузки контактов:",e)}finally{x(!1)}},q=async e=>{_(!0),p(!1);try{const a=E(e.workingSchedule);await D.update({phone:e.phone,whatsappPhone:String(e.whatsappPhone||"").replace(/\D/g,""),email:e.email,address:e.address,workingHours:a,workingSchedule:e.workingSchedule,mapEmbedUrl:e.mapEmbedUrl||"",socialMedia:{instagram:e.instagram,vk:e.vk,telegram:e.telegram,whatsapp:e.whatsapp}}),p(!0),setTimeout(()=>p(!1),3e3)}catch(a){console.error("Ошибка сохранения контактов:",a),alert("Ошибка при сохранении контактов")}finally{_(!1)}};if(L)return s.jsx(V,{variant:"admin"});const G=r("workingSchedule")||$(),O=E(G),B=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],F=["Пн","Вт","Ср","Чт","Пт"],y=e=>{for(const a of F)d(`workingSchedule.${a}.closed`,e.closed,{shouldDirty:!0}),d(`workingSchedule.${a}.open`,e.open,{shouldDirty:!0}),d(`workingSchedule.${a}.close`,e.close,{shouldDirty:!0})},i=(e,a)=>{d(`workingSchedule.${e}.closed`,a.closed,{shouldDirty:!0}),d(`workingSchedule.${e}.open`,a.open,{shouldDirty:!0}),d(`workingSchedule.${e}.close`,a.close,{shouldDirty:!0})},M=e=>{const h=I("workingSchedule")?.[e];if(!h||h.closed)return!0;const R=String(h.open||""),T=String(h.close||"");return!R||!T?!1:R<T},N=r("workingSchedule.Пн.open")||"09:00",C=r("workingSchedule.Пн.close")||"18:00",g=!!r("workingSchedule.Сб.closed"),m=r("workingSchedule.Сб.open")||"10:00",w=r("workingSchedule.Сб.close")||"16:00",S=!!r("workingSchedule.Вс.closed"),k=r("workingSchedule.Вс.open")||"10:00",v=r("workingSchedule.Вс.close")||"16:00";return s.jsxs("div",{className:l.contacts,children:[s.jsx("h1",{className:l.title,children:"Редактирование контактов"}),s.jsxs(K,{className:l.card,children:[P&&s.jsx("div",{className:l.successMessage,children:"✓ Контакты успешно сохранены"}),s.jsxs("form",{onSubmit:H(q),className:l.form,children:[s.jsx(o,{label:"Телефон",...t("phone",{required:"Телефон обязателен"}),error:n.phone?.message}),s.jsx(o,{label:"WhatsApp номер (для wa.me, формат 7700..., без + и пробелов)",...t("whatsappPhone",{validate:e=>{if(!e)return!0;const a=String(e).replace(/\D/g,"");return a.length!==11?"Введите номер из 11 цифр (например 77001234567)":a.startsWith("7")?!0:"Номер должен начинаться с 7"}}),error:n.whatsappPhone?.message}),s.jsx(o,{label:"Email",type:"email",...t("email",{required:"Email обязателен"}),error:n.email?.message}),s.jsx(o,{label:"Адрес",...t("address",{required:"Адрес обязателен"}),error:n.address?.message}),s.jsx("h3",{className:l.sectionTitle,children:"График работы"}),s.jsx("div",{className:l.scheduleModeRow,children:s.jsxs("label",{className:l.scheduleModeLabel,children:[s.jsx("span",{style:{fontWeight:600},children:"Режим:"}),s.jsxs("select",{className:l.scheduleModeSelect,value:j,onChange:e=>{const a=e.target.value==="advanced"?"advanced":"simple";A(a),localStorage.setItem("admin_schedule_mode",a)},children:[s.jsx("option",{value:"simple",children:"Простой (Пн‑Пт / Сб / Вс)"}),s.jsx("option",{value:"advanced",children:"По дням (расширенный)"})]})]})}),j==="simple"?s.jsxs("div",{className:l.scheduleGrid,children:[s.jsxs("div",{className:l.scheduleRowSimpleWeek,children:[s.jsx("div",{className:l.dayLabel,children:"Пн‑Пт"}),s.jsx(o,{label:"Открытие",type:"time",step:900,value:N,onChange:e=>y({open:e.target.value,close:C,closed:!1})}),s.jsx(o,{label:"Закрытие",type:"time",step:900,value:C,onChange:e=>y({open:N,close:e.target.value,closed:!1})})]}),s.jsxs("div",{className:l.scheduleRowSimpleDay,children:[s.jsx("div",{className:l.dayLabel,children:"Сб"}),s.jsx(o,{label:"Открытие",type:"time",step:900,disabled:g,value:m,onChange:e=>i("Сб",{open:e.target.value,close:w,closed:!1})}),s.jsx(o,{label:"Закрытие",type:"time",step:900,disabled:g,value:w,onChange:e=>i("Сб",{open:m,close:e.target.value,closed:!1})}),s.jsxs("label",{className:l.closedToggle,children:[s.jsx("input",{type:"checkbox",checked:g,onChange:e=>i("Сб",{open:m,close:w,closed:e.target.checked})}),"Выходной"]})]}),s.jsxs("div",{className:l.scheduleRowSimpleDay,children:[s.jsx("div",{className:l.dayLabel,children:"Вс"}),s.jsx(o,{label:"Открытие",type:"time",step:900,disabled:S,value:k,onChange:e=>i("Вс",{open:e.target.value,close:v,closed:!1})}),s.jsx(o,{label:"Закрытие",type:"time",step:900,disabled:S,value:v,onChange:e=>i("Вс",{open:k,close:e.target.value,closed:!1})}),s.jsxs("label",{className:l.closedToggle,children:[s.jsx("input",{type:"checkbox",checked:S,onChange:e=>i("Вс",{open:k,close:v,closed:e.target.checked})}),"Выходной"]})]})]}):s.jsx("div",{className:l.scheduleGrid,children:B.map(e=>s.jsxs("div",{className:l.scheduleRowAdvanced,children:[s.jsx("div",{className:l.dayLabel,children:e}),s.jsx(o,{label:"Открытие",type:"time",step:900,disabled:r(`workingSchedule.${e}.closed`),...t(`workingSchedule.${e}.open`,{required:!r(`workingSchedule.${e}.closed`),validate:()=>M(e)||"Открытие должно быть раньше закрытия"})}),s.jsx(o,{label:"Закрытие",type:"time",step:900,disabled:r(`workingSchedule.${e}.closed`),...t(`workingSchedule.${e}.close`,{required:!r(`workingSchedule.${e}.closed`),validate:()=>M(e)||"Закрытие должно быть позже открытия"})}),s.jsxs("label",{className:l.closedToggle,children:[s.jsx("input",{type:"checkbox",...t(`workingSchedule.${e}.closed`)}),"Выходной"]})]},e))}),s.jsxs("div",{className:l.preview,children:[s.jsx("strong",{children:"Как будет показано на сайте:"})," ",O]}),s.jsx(o,{label:"Ссылка для встраивания карты (iframe src)",type:"url",...t("mapEmbedUrl"),error:n.mapEmbedUrl?.message}),s.jsx("h3",{className:l.sectionTitle,children:"Социальные сети"}),s.jsx(o,{label:"Instagram",type:"url",...t("instagram"),error:n.instagram?.message}),s.jsx(o,{label:"VK",type:"url",...t("vk"),error:n.vk?.message}),s.jsx(o,{label:"Telegram",type:"url",...t("telegram"),error:n.telegram?.message}),s.jsx(o,{label:"WhatsApp",type:"url",...t("whatsapp"),error:n.whatsapp?.message}),s.jsx("div",{className:l.actions,children:s.jsx(X,{type:"submit",disabled:b,children:b?"Сохранение...":"Сохранить"})})]})]})]})};export{ke as default};
