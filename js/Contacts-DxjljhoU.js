import{W as $,X as B,C as t,Y as E,j as s,p as R,Z as D,h as X,I as l,B as Y}from"./index-D4B8EBv7.js";import{r as p}from"./react-vendor-BQWX9zlF.js";import{u as Z}from"./form-vendor-BjD3cHyu.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-mpaoXh-M.js";const z="_contacts_amv71_1",G="_title_amv71_5",J="_card_amv71_15",Q="_successMessage_amv71_19",ee="_form_amv71_28",se="_sectionTitle_amv71_34",ae="_actions_amv71_40",i={contacts:z,title:G,card:J,successMessage:Q,form:ee,sectionTitle:se,actions:ae},ie=()=>{const[N,k]=p.useState(!0),[y,j]=p.useState(!1),[P,m]=p.useState(!1),[S,H]=p.useState(()=>localStorage.getItem("admin_schedule_mode")==="advanced"?"advanced":"simple"),{register:r,handleSubmit:U,formState:{errors:n},reset:b,watch:o,getValues:q,setValue:c}=Z();p.useEffect(()=>{O()},[]);const O=async()=>{try{k(!0);const e=await $.get();if(e){const a=e.workingSchedule||B(e.workingHours||t.workingHours)||E();b({phone:e.phone||t.phone,whatsappPhone:e.whatsappPhone||"",email:e.email||t.email,address:e.address||t.address,workingSchedule:a,mapEmbedUrl:e.mapEmbedUrl||"",instagram:e.socialMedia?.instagram||t.socialMedia.instagram,vk:e.socialMedia?.vk||t.socialMedia.vk,telegram:e.socialMedia?.telegram||t.socialMedia.telegram,whatsapp:e.socialMedia?.whatsapp||t.socialMedia.whatsapp})}else b({phone:t.phone,whatsappPhone:"",email:t.email,address:t.address,workingSchedule:B(t.workingHours),mapEmbedUrl:"",instagram:t.socialMedia.instagram,vk:t.socialMedia.vk,telegram:t.socialMedia.telegram,whatsapp:t.socialMedia.whatsapp})}catch(e){console.error("Ошибка загрузки контактов:",e)}finally{k(!1)}},F=async e=>{j(!0),m(!1);try{const a=D(e.workingSchedule);await $.update({phone:e.phone,whatsappPhone:String(e.whatsappPhone||"").replace(/\D/g,""),email:e.email,address:e.address,workingHours:a,workingSchedule:e.workingSchedule,mapEmbedUrl:e.mapEmbedUrl||"",socialMedia:{instagram:e.instagram,vk:e.vk,telegram:e.telegram,whatsapp:e.whatsapp}}),m(!0),setTimeout(()=>m(!1),3e3)}catch(a){console.error("Ошибка сохранения контактов:",a),alert("Ошибка при сохранении контактов")}finally{j(!1)}};if(N)return s.jsx(R,{variant:"admin"});const A=o("workingSchedule")||E(),V=D(A),K=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],L=["Пн","Вт","Ср","Чт","Пт"],_=e=>{for(const a of L)c(`workingSchedule.${a}.closed`,e.closed,{shouldDirty:!0}),c(`workingSchedule.${a}.open`,e.open,{shouldDirty:!0}),c(`workingSchedule.${a}.close`,e.close,{shouldDirty:!0})},d=(e,a)=>{c(`workingSchedule.${e}.closed`,a.closed,{shouldDirty:!0}),c(`workingSchedule.${e}.open`,a.open,{shouldDirty:!0}),c(`workingSchedule.${e}.close`,a.close,{shouldDirty:!0})},C=e=>{const g=q("workingSchedule")?.[e];if(!g||g.closed)return!0;const I=String(g.open||""),W=String(g.close||"");return!I||!W?!1:I<W},M=o("workingSchedule.Пн.open")||"09:00",T=o("workingSchedule.Пн.close")||"18:00",u=!!o("workingSchedule.Сб.closed"),h=o("workingSchedule.Сб.open")||"10:00",x=o("workingSchedule.Сб.close")||"16:00",f=!!o("workingSchedule.Вс.closed"),w=o("workingSchedule.Вс.open")||"10:00",v=o("workingSchedule.Вс.close")||"16:00";return s.jsxs("div",{className:i.contacts,children:[s.jsx("h1",{className:i.title,children:"Редактирование контактов"}),s.jsxs(X,{className:i.card,children:[P&&s.jsx("div",{className:i.successMessage,children:"✓ Контакты успешно сохранены"}),s.jsxs("form",{onSubmit:U(F),className:i.form,children:[s.jsx(l,{label:"Телефон",...r("phone",{required:"Телефон обязателен"}),error:n.phone?.message}),s.jsx(l,{label:"WhatsApp номер (для wa.me, формат 7700..., без + и пробелов)",...r("whatsappPhone",{validate:e=>{if(!e)return!0;const a=String(e).replace(/\D/g,"");return a.length!==11?"Введите номер из 11 цифр (например 77001234567)":a.startsWith("7")?!0:"Номер должен начинаться с 7"}}),error:n.whatsappPhone?.message}),s.jsx(l,{label:"Email",type:"email",...r("email",{required:"Email обязателен"}),error:n.email?.message}),s.jsx(l,{label:"Адрес",...r("address",{required:"Адрес обязателен"}),error:n.address?.message}),s.jsx("h3",{className:i.sectionTitle,children:"График работы"}),s.jsx("div",{style:{display:"flex",gap:10,flexWrap:"wrap",marginBottom:10},children:s.jsxs("label",{style:{display:"flex",gap:10,alignItems:"center"},children:[s.jsx("span",{style:{fontWeight:600},children:"Режим:"}),s.jsxs("select",{value:S,onChange:e=>{const a=e.target.value==="advanced"?"advanced":"simple";H(a),localStorage.setItem("admin_schedule_mode",a)},children:[s.jsx("option",{value:"simple",children:"Простой (Пн‑Пт / Сб / Вс)"}),s.jsx("option",{value:"advanced",children:"По дням (расширенный)"})]})]})}),S==="simple"?s.jsxs("div",{style:{display:"grid",gap:10},children:[s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr 1fr",gap:10,alignItems:"end"},children:[s.jsx("div",{style:{fontWeight:600,paddingBottom:8},children:"Пн‑Пт"}),s.jsx(l,{label:"Открытие",type:"time",step:900,value:M,onChange:e=>_({open:e.target.value,close:T,closed:!1})}),s.jsx(l,{label:"Закрытие",type:"time",step:900,value:T,onChange:e=>_({open:M,close:e.target.value,closed:!1})})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr 1fr 120px",gap:10,alignItems:"end"},children:[s.jsx("div",{style:{fontWeight:600,paddingBottom:8},children:"Сб"}),s.jsx(l,{label:"Открытие",type:"time",step:900,disabled:u,value:h,onChange:e=>d("Сб",{open:e.target.value,close:x,closed:!1})}),s.jsx(l,{label:"Закрытие",type:"time",step:900,disabled:u,value:x,onChange:e=>d("Сб",{open:h,close:e.target.value,closed:!1})}),s.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center",paddingBottom:8},children:[s.jsx("input",{type:"checkbox",checked:u,onChange:e=>d("Сб",{open:h,close:x,closed:e.target.checked})}),"Выходной"]})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr 1fr 120px",gap:10,alignItems:"end"},children:[s.jsx("div",{style:{fontWeight:600,paddingBottom:8},children:"Вс"}),s.jsx(l,{label:"Открытие",type:"time",step:900,disabled:f,value:w,onChange:e=>d("Вс",{open:e.target.value,close:v,closed:!1})}),s.jsx(l,{label:"Закрытие",type:"time",step:900,disabled:f,value:v,onChange:e=>d("Вс",{open:w,close:e.target.value,closed:!1})}),s.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center",paddingBottom:8},children:[s.jsx("input",{type:"checkbox",checked:f,onChange:e=>d("Вс",{open:w,close:v,closed:e.target.checked})}),"Выходной"]})]})]}):s.jsx("div",{style:{display:"grid",gap:10},children:K.map(e=>s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"72px 1fr 1fr 120px",gap:10,alignItems:"end"},children:[s.jsx("div",{style:{fontWeight:600,paddingBottom:8},children:e}),s.jsx(l,{label:"Открытие",type:"time",step:900,disabled:o(`workingSchedule.${e}.closed`),...r(`workingSchedule.${e}.open`,{required:!o(`workingSchedule.${e}.closed`),validate:()=>C(e)||"Открытие должно быть раньше закрытия"})}),s.jsx(l,{label:"Закрытие",type:"time",step:900,disabled:o(`workingSchedule.${e}.closed`),...r(`workingSchedule.${e}.close`,{required:!o(`workingSchedule.${e}.closed`),validate:()=>C(e)||"Закрытие должно быть позже открытия"})}),s.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center",paddingBottom:8},children:[s.jsx("input",{type:"checkbox",...r(`workingSchedule.${e}.closed`)}),"Выходной"]})]},e))}),s.jsxs("div",{style:{marginTop:8,opacity:.85},children:[s.jsx("strong",{children:"Как будет показано на сайте:"})," ",V]}),s.jsx(l,{label:"Ссылка для встраивания карты (iframe src)",type:"url",...r("mapEmbedUrl"),error:n.mapEmbedUrl?.message}),s.jsx("h3",{className:i.sectionTitle,children:"Социальные сети"}),s.jsx(l,{label:"Instagram",type:"url",...r("instagram"),error:n.instagram?.message}),s.jsx(l,{label:"VK",type:"url",...r("vk"),error:n.vk?.message}),s.jsx(l,{label:"Telegram",type:"url",...r("telegram"),error:n.telegram?.message}),s.jsx(l,{label:"WhatsApp",type:"url",...r("whatsapp"),error:n.whatsapp?.message}),s.jsx("div",{className:i.actions,children:s.jsx(Y,{type:"submit",disabled:y,children:y?"Сохранение...":"Сохранить"})})]})]})]})};export{ie as default};
