import{j as e,h as q,B as d,K as P,I as N,x as k,p as U}from"./index-BdSluZxw.js";import{r as j}from"./react-vendor-BQWX9zlF.js";import{u as z,b as I}from"./form-vendor-BjD3cHyu.js";import{T as F}from"./Textarea-B-13Wzae.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-CGxEfUHl.js";const A="_list_1u8yt_1",E="_item_1u8yt_7",R="_content_1u8yt_14",T="_image_1u8yt_21",L="_info_1u8yt_28",V="_name_1u8yt_32",K="_category_1u8yt_38",M="_price_1u8yt_44",G="_badge_1u8yt_51",H="_actions_1u8yt_62",J="_empty_1u8yt_67",c={list:A,item:E,content:R,image:T,info:L,name:V,category:K,price:M,badge:G,actions:H,empty:J},O=({procedures:s,onEdit:u,onDelete:o})=>s.length===0?e.jsx(q,{className:c.empty,children:e.jsx("p",{children:"Процедур пока нет. Добавьте первую процедуру."})}):e.jsx("div",{className:c.list,children:s.map(a=>e.jsxs(q,{className:c.item,children:[e.jsxs("div",{className:c.content,children:[a.images&&a.images.length>0&&e.jsx("img",{src:a.images[0],alt:a.name,className:c.image}),e.jsxs("div",{className:c.info,children:[e.jsx("h3",{className:c.name,children:a.name}),e.jsx("p",{className:c.category,children:a.category}),e.jsxs("p",{className:c.price,children:[a.price," ₽"]}),a.popular&&e.jsx("span",{className:c.badge,children:"Популярная"})]})]}),e.jsxs("div",{className:c.actions,children:[e.jsx(d,{size:"small",onClick:()=>u(a),children:"Редактировать"}),e.jsx(d,{size:"small",variant:"secondary",onClick:()=>o(a.id),children:"Удалить"})]})]},a.id))}),Q="_imageUpload_2dtxu_1",W="_images_2dtxu_5",X="_imageItem_2dtxu_12",Y="_removeButton_2dtxu_27",Z="_uploadButton_2dtxu_50",ee="_hint_2dtxu_65",C={imageUpload:Q,images:W,imageItem:X,removeButton:Y,uploadButton:Z,hint:ee},se=({value:s=[],onChange:u,maxImages:o=5,folder:a="procedures"})=>{const[_,i]=j.useState(!1),x=j.useRef(null),r=async p=>{const l=p.target.files;if(!l||l.length===0)return;const v=o-s.length,f=Array.from(l).slice(0,v);if(f.length===0){alert(`Максимум ${o} изображений`);return}i(!0);try{const y=await P.uploadMultipleImages(f,a);u([...s,...y])}catch(y){console.error("Ошибка загрузки изображений:",y),alert("Ошибка при загрузке изображений")}finally{i(!1),x.current&&(x.current.value="")}},g=p=>{const l=s.filter((v,f)=>f!==p);u(l)};return e.jsxs("div",{className:C.imageUpload,children:[e.jsxs("div",{className:C.images,children:[s.map((p,l)=>e.jsxs("div",{className:C.imageItem,children:[e.jsx("img",{src:p,alt:`Изображение ${l+1}`}),e.jsx("button",{type:"button",className:C.removeButton,onClick:()=>g(l),children:"×"})]},l)),s.length<o&&e.jsxs("div",{className:C.uploadButton,children:[e.jsx("input",{ref:x,type:"file",accept:"image/*",multiple:!0,onChange:r,disabled:_,style:{display:"none"}}),e.jsx(d,{type:"button",size:"small",onClick:()=>x.current?.click(),disabled:_,children:_?"Загрузка...":"+ Добавить"})]})]}),s.length>=o&&e.jsxs("p",{className:C.hint,children:["Достигнут лимит изображений (",o,")"]})]})},te="_formContainer_6ep8q_1",ae="_card_6ep8q_5",ie="_header_6ep8q_9",ne="_form_6ep8q_1",re="_row_6ep8q_27",le="_field_6ep8q_33",oe="_label_6ep8q_39",ce="_arrayItem_6ep8q_45",de="_checkbox_6ep8q_55",me="_actions_6ep8q_65",n={formContainer:te,card:ae,header:ie,form:ne,row:re,field:le,label:oe,arrayItem:ce,checkbox:de,actions:me},ue=({procedure:s,onClose:u,onSuccess:o})=>{const[a,_]=j.useState(!1),{register:i,handleSubmit:x,formState:{errors:r},control:g,setValue:p,watch:l}=z({defaultValues:{name:s?.name||"",category:s?.category||"",description:s?.description||"",fullDescription:s?.fullDescription||"",price:s?.price||0,duration:s?.duration||60,images:s?.images||[],indications:s?.indications?.map(t=>({value:t}))||[{value:""}],contraindications:s?.contraindications?.map(t=>({value:t}))||[{value:""}],popular:s?.popular||!1}}),{fields:v,append:f,remove:y}=I({control:g,name:"indications"}),{fields:h,append:w,remove:B}=I({control:g,name:"contraindications"}),D=l("images"),$=async t=>{_(!0);try{const m={name:t.name,category:t.category,description:t.description,fullDescription:t.fullDescription,price:Number(t.price),duration:Number(t.duration),images:t.images,indications:t.indications.map(b=>b.value).filter(b=>b.trim()),contraindications:t.contraindications.map(b=>b.value).filter(b=>b.trim()),popular:t.popular};s?await k.update(s.id,m):await k.create(m),o()}catch(m){console.error("Ошибка сохранения процедуры:",m),alert("Ошибка при сохранении процедуры")}finally{_(!1)}};return e.jsx("div",{className:n.formContainer,children:e.jsxs(q,{className:n.card,children:[e.jsxs("div",{className:n.header,children:[e.jsx("h2",{children:s?"Редактировать процедуру":"Добавить процедуру"}),e.jsx(d,{variant:"secondary",onClick:u,children:"×"})]}),e.jsxs("form",{onSubmit:x($),className:n.form,children:[e.jsx(N,{label:"Название",...i("name",{required:"Название обязательно"}),error:r.name?.message}),e.jsx(N,{label:"Категория",...i("category",{required:"Категория обязательна"}),error:r.category?.message}),e.jsx(F,{label:"Краткое описание",rows:3,...i("description",{required:"Описание обязательно"}),error:r.description?.message}),e.jsx(F,{label:"Полное описание",rows:5,...i("fullDescription",{required:"Полное описание обязательно"}),error:r.fullDescription?.message}),e.jsxs("div",{className:n.row,children:[e.jsx(N,{label:"Цена (₽)",type:"number",...i("price",{required:"Цена обязательна",min:{value:0,message:"Цена должна быть положительной"},valueAsNumber:!0}),error:r.price?.message}),e.jsx(N,{label:"Длительность (минуты)",type:"number",...i("duration",{required:"Длительность обязательна",min:{value:1,message:"Минимум 1 минута"},valueAsNumber:!0}),error:r.duration?.message})]}),e.jsxs("div",{className:n.field,children:[e.jsx("label",{className:n.label,children:"Изображения"}),e.jsx(se,{value:D,onChange:t=>p("images",t),maxImages:5,folder:"procedures"})]}),e.jsxs("div",{className:n.field,children:[e.jsx("label",{className:n.label,children:"Показания"}),v.map((t,m)=>e.jsxs("div",{className:n.arrayItem,children:[e.jsx(N,{...i(`indications.${m}.value`),placeholder:"Показание"}),e.jsx(d,{type:"button",variant:"secondary",size:"small",onClick:()=>y(m),children:"Удалить"})]},t.id)),e.jsx(d,{type:"button",variant:"outline",size:"small",onClick:()=>f({value:""}),children:"+ Добавить показание"})]}),e.jsxs("div",{className:n.field,children:[e.jsx("label",{className:n.label,children:"Противопоказания"}),h.map((t,m)=>e.jsxs("div",{className:n.arrayItem,children:[e.jsx(N,{...i(`contraindications.${m}.value`),placeholder:"Противопоказание"}),e.jsx(d,{type:"button",variant:"secondary",size:"small",onClick:()=>B(m),children:"Удалить"})]},t.id)),e.jsx(d,{type:"button",variant:"outline",size:"small",onClick:()=>w({value:""}),children:"+ Добавить противопоказание"})]}),e.jsxs("div",{className:n.checkbox,children:[e.jsx("input",{type:"checkbox",id:"popular",...i("popular")}),e.jsx("label",{htmlFor:"popular",children:"Популярная процедура"})]}),e.jsxs("div",{className:n.actions,children:[e.jsx(d,{type:"submit",disabled:a,children:a?"Сохранение...":"Сохранить"}),e.jsx(d,{type:"button",variant:"secondary",onClick:u,children:"Отмена"})]})]})]})})},pe="_procedures_jpmit_1",he="_header_jpmit_5",_e="_title_jpmit_12",S={procedures:pe,header:he,title:_e},ve=()=>{const[s,u]=j.useState([]),[o,a]=j.useState(!0),[_,i]=j.useState(!1),[x,r]=j.useState(null);j.useEffect(()=>{g()},[]);const g=async()=>{try{a(!0);const h=await k.getAll();u(h)}catch(h){console.error("Ошибка загрузки процедур:",h)}finally{a(!1)}},p=()=>{r(null),i(!0)},l=h=>{r(h),i(!0)},v=async h=>{if(window.confirm("Вы уверены, что хотите удалить эту процедуру?"))try{await k.delete(h),await g()}catch(w){console.error("Ошибка удаления процедуры:",w),alert("Ошибка при удалении процедуры")}},f=()=>{i(!1),r(null)},y=()=>{i(!1),r(null),g()};return _?e.jsx(ue,{procedure:x,onClose:f,onSuccess:y}):e.jsxs("div",{className:S.procedures,children:[e.jsxs("div",{className:S.header,children:[e.jsx("h1",{className:S.title,children:"Управление процедурами"}),e.jsx(d,{onClick:p,children:"+ Добавить процедуру"})]}),o?e.jsx(U,{variant:"admin"}):e.jsx(O,{procedures:s,onEdit:l,onDelete:v})]})};export{ve as default};
