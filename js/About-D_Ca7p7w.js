import{$ as b,j as e,p as F,h as M,I as l,B as m,U as T}from"./index-COQO_83p.js";import{r as o}from"./react-vendor-BQWX9zlF.js";import{u as U,b as $}from"./form-vendor-BjD3cHyu.js";import{T as j}from"./Textarea-CgX3Dyx-.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-mpaoXh-M.js";const A="_about_4x7mz_1",E="_title_4x7mz_5",B="_card_4x7mz_15",L="_successMessage_4x7mz_19",R="_form_4x7mz_28",V="_field_4x7mz_34",D="_label_4x7mz_40",G="_photoPreview_4x7mz_46",H="_removePhoto_4x7mz_62",J="_hint_4x7mz_84",K="_arrayItem_4x7mz_90",O="_actions_4x7mz_100",a={about:A,title:E,card:B,successMessage:L,form:R,field:V,label:D,photoPreview:G,removePhoto:H,hint:J,arrayItem:K,actions:O},se=()=>{const[v,d]=o.useState(!0),[u,p]=o.useState(!1),[g,c]=o.useState(!1),[h,f]=o.useState(!1),{register:r,handleSubmit:y,formState:{errors:i},control:z,setValue:x,watch:N,reset:P}=U({defaultValues:{name:"",photo:"",education:"",experience:"",description:"",certificates:[]}}),{fields:S,append:w,remove:I}=$({control:z,name:"certificates"}),_=N("photo");o.useEffect(()=>{C()},[]);const C=async()=>{try{d(!0);const s=await b.get();s&&P({name:s.name||"",photo:s.photo||"",education:s.education||"",experience:s.experience||"",description:s.description||"",certificates:s.certificates?.map(t=>({value:t}))||[]})}catch(s){console.error("Ошибка загрузки информации:",s)}finally{d(!1)}},k=async s=>{const t=s.target.files?.[0];if(t){f(!0);try{const n=await T.uploadImage(t,`about/${Date.now()}_${t.name}`);x("photo",n)}catch(n){console.error("Ошибка загрузки фото:",n),alert("Ошибка при загрузке фото")}finally{f(!1)}}},q=async s=>{p(!0),c(!1);try{await b.update({name:s.name,photo:s.photo,education:s.education,experience:s.experience,description:s.description,certificates:s.certificates.map(t=>t.value).filter(t=>t.trim())}),c(!0),setTimeout(()=>c(!1),3e3)}catch(t){console.error("Ошибка сохранения информации:",t),alert("Ошибка при сохранении информации")}finally{p(!1)}};return v?e.jsx(F,{variant:"admin"}):e.jsxs("div",{className:a.about,children:[e.jsx("h1",{className:a.title,children:'Редактирование "О специалисте"'}),e.jsxs(M,{className:a.card,children:[g&&e.jsx("div",{className:a.successMessage,children:"✓ Информация успешно сохранена"}),e.jsxs("form",{onSubmit:y(q),className:a.form,children:[e.jsx(l,{label:"Имя специалиста",...r("name",{required:"Имя обязательно"}),error:i.name?.message}),e.jsxs("div",{className:a.field,children:[e.jsx("label",{className:a.label,children:"Фото специалиста"}),_&&e.jsxs("div",{className:a.photoPreview,children:[e.jsx("img",{src:_,alt:"Фото специалиста"}),e.jsx("button",{type:"button",className:a.removePhoto,onClick:()=>x("photo",""),children:"×"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:k,disabled:h,style:{marginTop:"0.5rem"}}),h&&e.jsx("p",{className:a.hint,children:"Загрузка..."})]}),e.jsx(j,{label:"Образование",rows:3,...r("education",{required:"Образование обязательно"}),error:i.education?.message}),e.jsx(l,{label:"Опыт работы",...r("experience",{required:"Опыт работы обязателен"}),error:i.experience?.message}),e.jsx(j,{label:"Описание",rows:8,...r("description",{required:"Описание обязательно"}),error:i.description?.message}),e.jsxs("div",{className:a.field,children:[e.jsx("label",{className:a.label,children:"Сертификаты (ссылки)"}),S.map((s,t)=>e.jsxs("div",{className:a.arrayItem,children:[e.jsx(l,{...r(`certificates.${t}.value`),placeholder:"URL сертификата"}),e.jsx(m,{type:"button",variant:"secondary",size:"small",onClick:()=>I(t),children:"Удалить"})]},s.id)),e.jsx(m,{type:"button",variant:"outline",size:"small",onClick:()=>w({value:""}),children:"+ Добавить сертификат"})]}),e.jsx("div",{className:a.actions,children:e.jsx(m,{type:"submit",disabled:u,children:u?"Сохранение...":"Сохранить"})})]})]})]})};export{se as default};
