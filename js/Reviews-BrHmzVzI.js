import{a as b,j as e,I as E,B as z,u as J,h as F,S as _,i as U,c as V,d as q}from"./index-CQNrw-zk.js";import{R as Y,r as a}from"./react-vendor-BQWX9zlF.js";import{b as Q,u as W,s as X,i as Z,a as ee}from"./useInView-ioHx3Qob.js";import{S as O}from"./Select-ubhdnq9l.js";import{u as se,C as te}from"./form-vendor-BjD3cHyu.js";import{v as re}from"./validation-tERvU4A4.js";import{T as ae}from"./Textarea-BLWPGJpk.js";import{S as ie}from"./SEO-CUZvWHC-.js";import{R as ne}from"./Reveal-C_4sFoFz.js";import"./redux-vendor-B8TTZsxA.js";import"./firebase-vendor-CGxEfUHl.js";const $="cosmetology_reviews",oe="1.0",ce=()=>{try{const i=localStorage.getItem($);if(!i)return[];const r=JSON.parse(i);return r.version!==oe?r.reviews||[]:r.reviews||[]}catch(i){return console.error("Ошибка загрузки отзывов из localStorage:",i),[]}},le=i=>{const r=d=>{if(d.key===$&&d.newValue)try{const u=JSON.parse(d.newValue);i(u.reviews||[])}catch(u){console.error("Ошибка синхронизации отзывов:",u)}};return window.addEventListener("storage",r),()=>{window.removeEventListener("storage",r)}},de="_formContainer_137s1_1",ue="_title_137s1_9",me="_form_137s1_1",he="_ratingSection_137s1_22",ve="_ratingLabel_137s1_28",ge="_required_137s1_34",pe="_ratingStars_137s1_39",_e="_starLabel_137s1_46",xe="_starInput_137s1_59",fe="_star_137s1_46",we="_errorMessage_137s1_79",je="_submitButton_137s1_85",l={formContainer:de,title:ue,form:me,ratingSection:he,ratingLabel:ve,required:ge,ratingStars:pe,starLabel:_e,starInput:xe,star:fe,errorMessage:we,submitButton:je},Ne=({onSubmit:i,isSubmitting:r=!1})=>{const{items:d}=b(n=>n.procedures),{register:u,handleSubmit:x,control:m,formState:{errors:o},reset:f}=se({defaultValues:{rating:5}}),w=a.useMemo(()=>d.map(n=>({value:n.id,label:n.name})),[d]),p=n=>{i(n),f()};return e.jsxs("div",{className:l.formContainer,children:[e.jsx("h3",{className:l.title,children:"Оставить отзыв"}),e.jsxs("form",{onSubmit:x(p),className:l.form,children:[e.jsx(E,{label:"Ваше имя",...u("clientName",{required:"Имя обязательно для заполнения",minLength:{value:2,message:"Имя должно содержать минимум 2 символа"},maxLength:{value:50,message:"Имя не должно превышать 50 символов"}}),error:o.clientName?.message}),e.jsx(E,{label:"Телефон (не публикуется, нужен для подтверждения)",type:"tel",...u("phone",{required:"Телефон обязателен для подтверждения",validate:n=>re(n)||"Неверный формат телефона"}),error:o.phone?.message}),e.jsx(te,{name:"procedureId",control:m,rules:{required:"Выберите процедуру"},render:({field:n})=>e.jsx(O,{label:"Процедура",options:w,...n,error:o.procedureId?.message})}),e.jsxs("div",{className:l.ratingSection,children:[e.jsxs("label",{className:l.ratingLabel,children:["Оценка ",e.jsx("span",{className:l.required,children:"*"})]}),e.jsx("div",{className:l.ratingStars,children:[5,4,3,2,1].map(n=>e.jsxs("label",{className:l.starLabel,children:[e.jsx("input",{type:"radio",value:n,...u("rating",{required:"Выберите оценку"}),className:l.starInput}),e.jsx("span",{className:l.star,children:"⭐"})]},n))}),o.rating&&e.jsx("span",{className:l.errorMessage,children:o.rating.message})]}),e.jsx(ae,{label:"Ваш отзыв",...u("text",{required:"Отзыв обязателен для заполнения",minLength:{value:10,message:"Отзыв должен содержать минимум 10 символов"},maxLength:{value:1e3,message:"Отзыв не должен превышать 1000 символов"}}),error:o.text?.message,rows:5}),e.jsx(z,{type:"submit",size:"large",disabled:r,className:l.submitButton,children:r?"Отправка...":"Отправить отзыв"})]})]})},Se=Y.memo(Ne),Re="_reviews_2uvf8_1",be="_container_2uvf8_6",ye="_title_2uvf8_11",Me="_header_2uvf8_19",Ce="_ratingSection_2uvf8_28",Ie="_averageRating_2uvf8_33",Le="_ratingValue_2uvf8_40",Ae="_stars_2uvf8_48",Pe="_ratingText_2uvf8_53",Te="_filter_2uvf8_59",Ee="_reviewsGrid_2uvf8_65",Fe="_reviewCard_2uvf8_71",Ve="_reviewHeader_2uvf8_78",qe="_reviewAuthor_2uvf8_85",Oe="_authorPhoto_2uvf8_92",$e="_authorPlaceholder_2uvf8_99",Ge="_authorName_2uvf8_112",ke="_procedureName_2uvf8_119",Be="_reviewRating_2uvf8_125",He="_reviewText_2uvf8_131",Ke="_reviewDate_2uvf8_138",De="_empty_2uvf8_144",t={reviews:Re,container:be,title:ye,header:Me,ratingSection:Ce,averageRating:Ie,ratingValue:Le,stars:Ae,ratingText:Pe,filter:Te,reviewsGrid:Ee,reviewCard:Fe,reviewHeader:Ve,reviewAuthor:qe,authorPhoto:Oe,authorPlaceholder:$e,authorName:Ge,procedureName:ke,reviewRating:Be,reviewText:He,reviewDate:Ke,empty:De},as=()=>{const i=J(),{items:r,averageRating:d,lastFetched:u,loading:x}=b(s=>s.reviews),{items:m}=b(s=>s.procedures),[o,f]=a.useState(""),[w,p]=a.useState(!1),[n,y]=a.useState(null),M=!0,C=a.useRef("");a.useEffect(()=>{C.current=r.map(s=>`${s.id}:${s.approved===!0?"1":s.approved===!1?"0":"u"}`).join("|")},[r]),a.useEffect(()=>{(async()=>{i(V(!0));const c=ce(),S=3*60*1e3,D=[...r.length===0||Z(u,S)?await ee():[],...c],T=Array.from(new Map(D.map(v=>[v.id,v])).values());T.map(v=>`${v.id}:${v.approved===!0?"1":v.approved===!1?"0":"u"}`).join("|")!==C.current&&i(q(T)),i(V(!1))})()},[i,M]),a.useEffect(()=>le(c=>{i(q(c))}),[i]);const G=a.useMemo(()=>[{value:"",label:"Все процедуры"},...m.map(s=>({value:s.id,label:s.name}))],[m]),g=a.useMemo(()=>r.filter(s=>s.approved===!0),[r]),h=a.useMemo(()=>o?g.filter(s=>s.procedureId===o):g,[g,o]),I=Q(x&&r.length===0,160),[j,L]=a.useState(6),{ref:k,inView:N}=W({once:!1,rootMargin:"700px 0px"}),A=a.useRef(!1);a.useEffect(()=>{L(6)},[o]),a.useEffect(()=>{const s=A.current;A.current=N,!(!N||s)&&L(c=>Math.min(c+4,h.length))},[N,h.length]);const B=a.useMemo(()=>h.slice(0,j),[h,j]),H=a.useCallback(async s=>{p(!0),y(null);const S=m.find(P=>P.id===s.procedureId)?.name||"Неизвестная процедура",R=await X({clientName:s.clientName,phone:s.phone,procedureId:s.procedureId,procedureName:S,rating:s.rating,text:s.text});R.success,y(R.message),p(!1)},[i,m,r]),K=s=>{const c=Math.max(0,Math.min(5,Number.isFinite(s)?s:0));return"⭐".repeat(c)+"☆".repeat(5-c)};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{title:"Отзывы",description:"Отзывы наших клиентов о косметологических процедурах. Реальные истории и результаты.",keywords:"отзывы косметология, отзывы клиентов, косметологические процедуры отзывы"}),e.jsx("div",{className:t.reviews,children:e.jsxs("div",{className:t.container,children:[e.jsx("h1",{className:t.title,children:"Отзывы клиентов"}),n&&e.jsx(F,{className:t.reviewCard,children:e.jsx("p",{children:n})}),e.jsx(Se,{onSubmit:H,isSubmitting:w}),I?e.jsxs("div",{className:t.header,children:[e.jsx("div",{className:t.ratingSection,children:e.jsxs("div",{className:t.averageRating,children:[e.jsx(_,{variant:"text",height:26,width:56}),e.jsx("div",{className:t.stars,style:{marginTop:6},children:e.jsx(_,{variant:"text",height:16,width:120})}),e.jsx("p",{className:t.ratingText,style:{marginTop:8},children:e.jsx(_,{variant:"text",height:12,width:180})})]})}),e.jsx("div",{className:t.filter,children:e.jsx(_,{height:56,radius:12})})]}):g.length>0?e.jsxs("div",{className:t.header,children:[e.jsx("div",{className:t.ratingSection,children:e.jsxs("div",{className:t.averageRating,children:[e.jsx("span",{className:t.ratingValue,children:d.toFixed(1)}),e.jsxs("div",{className:t.stars,children:["⭐".repeat(Math.max(0,Math.min(5,Math.round(d)))),"☆".repeat(5-Math.max(0,Math.min(5,Math.round(d))))]}),e.jsxs("p",{className:t.ratingText,children:["На основе ",g.length," отзывов"]})]})}),e.jsx("div",{className:t.filter,children:e.jsx(O,{label:"Фильтр по процедуре",options:G,value:o,onChange:s=>f(s.target.value)})})]}):null,I?e.jsx("div",{className:t.reviewsGrid,children:Array.from({length:6}).map((s,c)=>e.jsx(U,{},c))}):h.length>0?e.jsxs("div",{className:t.reviewsGrid,children:[B.map((s,c)=>e.jsx(ne,{delayMs:Math.min(c*22,180),children:e.jsxs(F,{className:t.reviewCard,children:[e.jsxs("div",{className:t.reviewHeader,children:[e.jsxs("div",{className:t.reviewAuthor,children:[s.clientPhoto?e.jsx("img",{src:s.clientPhoto,alt:s.clientName,className:t.authorPhoto,loading:"lazy"}):e.jsx("div",{className:t.authorPlaceholder,children:s.clientName.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:t.authorName,children:s.clientName}),e.jsx("p",{className:t.procedureName,children:s.procedureName})]})]}),e.jsx("div",{className:t.reviewRating,children:K(s.rating)})]}),e.jsx("p",{className:t.reviewText,children:s.text}),e.jsx("p",{className:t.reviewDate,children:new Date(s.date).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})})]})},s.id)),j<h.length&&e.jsx("div",{ref:k,style:{height:1,width:"100%",gridColumn:"1 / -1"},"aria-hidden":"true"})]}):e.jsx("div",{className:t.empty,children:e.jsx("p",{children:o?"Нет отзывов по выбранной процедуре":"Отзывов пока нет"})})]})})]})};export{as as default};
